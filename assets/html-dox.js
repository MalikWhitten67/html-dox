let e=[],t=document.querySelector("imports");t.style.visibility="hidden";let r=t.innerHTML.replace(/\s/g,"");if(r=r.split(","),r=r.filter(Boolean),document.querySelector("script")&&!document.querySelector("script").getAttribute("src").includes("html-dox.js"))throw new Error("html-dox.js must be the last script tag in the body");if(document.querySelector("style"))throw new Error("Style tags are not supported in dox!");if(document.querySelector("link"))throw new Error("Link tags are not supported in dox!");document.body.style.visibility="hidden";let n=[],o={"dox:string":String,"dox:number":Number,"dox:boolean":Boolean,"dox:array":Array,"dox:object":Object,"dox:undefined":void 0,"dox:null":null,"dox:function":Function,"dox:regexp":RegExp,"dox:date":Date};r.map((r=>{if(!r.endsWith(".html")&&!r.endsWith(".css")&&!r.endsWith(".js"))throw new Error("Unsupported imported file type!");if(r.endsWith(".html"))fetch(r).then((e=>e.text())).then((r=>{t.innerHTML=e,i(r)}));else if(r.endsWith(".css")){let e=document.createElement("link");e.setAttribute("rel","preload"),e.setAttribute("href",r),e.type="text/css",e.setAttribute("as","style");let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",r),t.type="text/css",document.querySelector("head").appendChild(t),document.querySelector("head").appendChild(e)}else r.endsWith(".js")&&fetch(r).then((e=>e.text())).then((e=>{if(e.includes("document")&&!r.includes("tailwind.js"))throw new Error("Imported js file cannot contain document use dox instead");if(e.includes("innerHTML")||e.includes("innerText")&&!r.endsWith("tailwind.js"))throw new Error("use dox:text  to return text and dox:$ to return html");new Function(e)()}))}));const i=t=>{let r=(new DOMParser).parseFromString(t,"text/html");r=r.querySelector("html");let l=document.querySelector("body"),a=[],s=r.querySelector("export")||null,c=[...r.querySelectorAll("*")].map((e=>e.tagName));c=c.filter(((e,t)=>c.indexOf(e)===t)),c=c.map((e=>e.toLowerCase())),c=c.filter((e=>"html"!==e&&"body"!==e&&"head"!==e&&"meta"!==e&&"div"!==e&&"function"!==e&&"render"!==e&&"type"!==e&&"subtype"!==e&&"export"!==e)),c=c.map((e=>"html-dox$"+e));["HTML","BODY","HEAD","META","FUNCTION","RENDER","TYPE","SUBTYPE","EXPORT"].map((e=>{let t=c.indexOf(e);t>-1&&c.splice(t,1)}));const u={querySelector:e=>{let t=e,r={};c=c.filter(((e,t)=>c.indexOf(e)===t)),c=c.map((e=>e.toLowerCase())),c=c.map((e=>e.replace("html-dox$",""))),c.forEach((e=>{const t=document.querySelector(e);t&&t.innerHTML.length>0&&(e="html-dox$"+e,[...t.children].map((e=>{t.$children=[...t.children],t.$children.map((e=>{e.inject=t=>{u.inject(t,e.tagName.toLowerCase())},e.querySelector=t=>{u.querySelector(e.tagName.toLowerCase()+" "+t)},e.querySelectorAll=t=>{u.querySelectorAll(e.tagName.toLowerCase()+" "+t)},e.$children=[...e.children]}))})),r[e]=t)}));let n=["html-dox$","dox$"].find((e=>t.includes(e)));if(!n)throw new Error("Unsupported query");if("dox$"==n&&(t=t.replace("dox$","html-dox$")),!r[t])throw new Error(`Element "${t}" does not exist`);return{dom:r[t],outerHTML:r[t].outerHTML,outerText:r[t].outerText,style:r[t].style,classList:r[t].classList,attributes:r[t].attributes,children:r[t].children,childNodes:r[t].childNodes,firstChild:r[t].firstChild,lastChild:r[t].lastChild,nextSibling:r[t].nextSibling,previousSibling:r[t].previousSibling,parentNode:r[t].parentNode,inject:e=>{t=t.replace("html-dox$",""),u.inject(e,t)},getDescendants:()=>{const e=[],n=t=>{e.push(t);const r=t.children;for(let e=0;e<r.length;e++){r[e].inject=t=>{u.inject(t,r[e].tagName.toLowerCase())},r[e].text=r[e].innerHTML.replace(/\s/g,""),r[e].$=r[e].innerHTML,r[e].querySelector=t=>u.querySelector(r[e].tagName.toLowerCase()+" "+t),r[e].querySelectorAll=t=>u.querySelectorAll(r[e].tagName.toLowerCase()+" "+t);const t=r[e].children;for(let e=0;e<t.length;e++)t[e].inject=r=>{u.inject(r,t[e].tagName.toLowerCase())},t[e].text=t[e].innerText,t[e].$=t[e].innerHTML,t[e].querySelector=r=>u.querySelector(t[e].tagName.toLowerCase()+" "+r),t[e].querySelectorAll=r=>u.querySelectorAll(t[e].tagName.toLowerCase()+" "+r),n(t[e])}};return n(r[t]),e},querySelector:e=>{t=t.replace("html-dox$",""),u.querySelector(t+" "+e)},onclick:e=>{r[t].addEventListener("click",e)},onhover:e=>{r[t].addEventListener("mouseover",e)},onmouseout:e=>{r[t].addEventListener("mouseout",e)},onfocus:e=>{r[t].addEventListener("focus",e)},Animation:e=>{r[t].style.animation=e},AnimationEffect:e=>{r[t].style.animationEffect=e},AnimationDelay:e=>{r[t].style.animationDelay=e},AnimationDirection:e=>{r[t].style.animationDirection=e},getChildren:()=>r[t].$children,setState:(e,t)=>{a.map((r=>{r.name===e&&(r.value=t)}))},getState:e=>{a.map((t=>{if(t.name===e)return t.value}))}}},querySelectorAll:e=>{let t=e,r={};c=c.filter(((e,t)=>c.indexOf(e)===t)),c=c.map((e=>e.toLowerCase())),c.map((e=>{let t=e.replace("html-dox$","");r[e]=document.querySelector(t)}));let n=["html-dox$","dox$"].find((e=>t.includes(e)));if(!n)throw new Error("Unsupported query");if("dox$"==n&&(t=t.replace("dox$","html-dox$")),!r[t])throw new Error(`Element "${t}" does not exist`);return{dom:r[t],text:r[t].innerHTML,outerHTML:r[t].outerHTML,outerText:r[t].outerText,style:r[t].style,classList:r[t].classList,attributes:r[t].attributes,children:r[t].children,childNodes:r[t].childNodes,firstChild:r[t].firstChild,lastChild:r[t].lastChild,nextSibling:r[t].nextSibling,previousSibling:r[t].previousSibling,parentNode:r[t].parentNode,inject:e=>{t=t.replace("html-dox$",""),u.inject(e,t)},querySelector:e=>{t=t.replace("html-dox$",""),u.querySelector(t+" "+e)},forEach:e=>{r[t].forEach((t=>{e(t)}))},getDescendants:()=>{const e=[],n=t=>{e.push(t);const r=t.children;for(let e=0;e<r.length;e++)n(r[e])};return n(r[t]),{forEach:t=>{e.forEach((r=>(t(r),{querySelector:t=>{e.map((e=>{u.querySelector(e.tagName.toLowerCase()+" "+t)}))},querySelectorAll:t=>{e.map((e=>{u.querySelectorAll(e.tagName.toLowerCase()+" "+t)}))},setState:(e,t)=>{a.map((r=>{r.name===e&&(r.value=t)}))},getState:e=>{a.map((t=>{if(t.name===e)return t.value}))}})))},map:t=>{e.map((e=>{t(e)}))}}},map:e=>{r[t].map((t=>{e(t)}))},filter:e=>{r[t].filter((t=>{e(t)}))},reduce:e=>{r[t].reduce((t=>{e(t)}))},reduceRight:e=>{r[t].reduceRight((t=>{e(t)}))},every:e=>{r[t].every((t=>{e(t)}))},some:e=>{r[t].some((t=>{e(t)}))},useState:e=>{let t=e;return[t,e=>{t=e,watchState(t)}]},watchState:(e,t)=>e=>{t(e)},setState:(e,t)=>{a.map((r=>{r.name===e&&(r.value=t)}))},onclick:e=>{r[t].onclick=e},getState:e=>{a.map((t=>{if(t.name===e)return t.value}))}}},inject:(e,t)=>{c=c.map((e=>"html-dox$"+e)),c=t.replace("html-dox$",""),c=c.toLowerCase(),c.includes(c)&&(document.querySelector(t).innerHTML=e)},state:(e,t)=>{a.push({name:e,value:t})},setState:(e,t)=>{a.map((r=>{r.name===e&&(r.value=t)}))},getState:e=>{a.map((t=>{if(t.name===e)return t.value}))}};window.dox=u,l.querySelectorAll("type").forEach((e=>{let t=e.querySelectorAll("subtype");n.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!o[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");n.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),t.forEach((e=>{if(!o[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");n.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),r.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];l.querySelectorAll(`[${t}]`).forEach((r=>{let i=r.getAttribute(t),l=e.getAttribute("subtype"),a=n.find((e=>e.name===l)),s=a.isStrict;if(a&&s){let e,t=o[a.constraint];if(t===Number){if(e=Number(i),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${l}": ${i} (expected number)`)}else if(t===Boolean)if("true"===i.toLowerCase())e=!0;else{if("false"!==i.toLowerCase())throw new Error(`Invalid attribute value for subtype "${l}": ${i} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${l}": ${a.constraint}`);e=i}}}))}}))})),r.querySelectorAll("type").forEach((e=>{let t=e.querySelectorAll("subtype"),i=[];t.forEach((t=>{if(i.push(t.getAttribute("name")),i.filter(((e,t)=>i.indexOf(e)!==t)).length>0)throw new Error("Two subtypes cannot have the same name");if(t.getAttribute("name")===e.getAttribute("name"))throw new Error("Types and subtypes cannot have the same name")})),n.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!o[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");n.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")})})),r.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];l.querySelectorAll(`[${t}]`).forEach((r=>{let i=r.getAttribute(t),l=e.getAttribute("subtype"),a=n.find((e=>e.name===l)),s=a.isStrict;if(a&&s){let e,t=o[a.constraint];if(t===Number){if(e=Number(i),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${l}": ${i} (expected number)`)}else if(t===Boolean)if("true"===i.toLowerCase())e=!0;else{if("false"!==i.toLowerCase())throw new Error(`Invalid attribute value for subtype "${l}": ${i} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${l}": ${a.constraint}`);e=i}}}))}}))}));let d=r.querySelectorAll("import");if(r.querySelectorAll("var").forEach((e=>{let t=e.getAttribute("name"),r=e.innerHTML;window[t]=r})),r.querySelectorAll("*").forEach((e=>{let t=e.innerHTML.match(/{{(.*?)}}/g);t&&t.forEach((t=>{let r=t.split("{{")[1].split("}}")[0];window.hasOwnProperty(r)&&(e.innerHTML=e.innerHTML.replace(`{{${r}}}`,window[r]))}))})),d.forEach((e=>{let t=e.getAttribute("src");if(!t.endsWith(".html"))throw new Error("Unsupported imported file type!");fetch(t).then((e=>e.text())).then((t=>{i(t);let n=e.getAttribute("exports").split(","),o=(new DOMParser).parseFromString(t,"text/html");if(o.querySelectorAll("var").forEach((e=>{let t=e.getAttribute("name"),r=e.innerHTML;window[t]=r})),o.querySelectorAll("*").forEach((e=>{let t=e.innerHTML.match(/{{(.*?)}}/g);t&&t.forEach((t=>{let r=t.split("{{")[1].split("}}")[0];window.hasOwnProperty(r)&&(e.innerHTML=e.innerHTML.replace(`{{${r}}}`,window[r]))}))})),o.querySelector("export")){o.querySelector("export").innerHTML.split(",").forEach((e=>{let t=e.replace(/\s/g,"");n.forEach((e=>{if(e==t&&r.querySelector(t)){if(r.querySelector(t).innerHTML.includes("{{")){let e=r.querySelector(t).innerHTML.split("{{")[1].split("}}")[0];r.querySelector(t).innerHTML=window[e]}l.querySelector(t).innerHTML=o.querySelector(t).innerHTML}}))}))}}))})),s){s=s.innerHTML.replace(/\s/g,""),s=s.split(","),s=s.filter(Boolean);let t;new Set;s.forEach((i=>{let a=r.querySelector(i);a&&a.attributes.length>0&&(t=a.attributes);if([].forEach((e=>{if(a.hasAttribute(e)&&"typeof"===e){let t=n.find((t=>t.name===a.getAttribute(e)));if(!t)throw new Error(`Type "${a.getAttribute(e)}" does not exist`);{let e,r=o[t.constraint],n=l.querySelector(i).innerHTML;if("false"===t.isStrict)return;if(r===Number){if(e=Number(n),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid value for type "${t.name}": ${n} (expected number)`)}else if(r===Boolean)if("true"===n.toLowerCase())e=!0;else{if("false"!==n.toLowerCase())throw new Error(`Invalid value for type "${t.name}": ${n} (expected boolean)`);e=!1}else{if(r!==String)throw new Error(`Invalid constraint type for type "${t.name}": ${t.constraint}`);e=n}}}})),a.getAttribute("props")){a.getAttribute("props").split(":").forEach((e=>{a.querySelectorAll("[derive]").forEach((e=>{let t=e.getAttribute("derive"),r=l.querySelector(i).getAttribute(t);e.innerHTML.includes(`{{${t}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t}}}`,r))})),a.innerHTML.includes(`{{${e}}}`)&&(a.innerHTML=a.innerHTML.replace(`{{${e}}}`,l.querySelector(i).getAttribute(e)))}))}e.push({name:a.tagName,template:a.innerHTML});let s=l.querySelector(i);function c(){s&&(document.querySelector(s.tagName).innerHTML=s.innerHTML)}s.innerHTML=a.innerHTML,c();let u=document.querySelector("html").getAttribute("root");function d(){if(c(),s){let t=s?s.parentNode:null,n=r.querySelector(i);if(t&&t.hasAttribute("route")){let r=t.getAttribute("route"),o=t.getAttribute("position");r&&"first"===o?e(s,n,"first",t.getAttribute("route")):r&&"last"===o&&e(s,n,"last",t.getAttribute("route"))}else e(s,n,"first",u)}function e(e,t,r,n){n="#"+n;e.innerHTML,t.innerHTML;e.querySelectorAll("*").forEach((e=>{e.hasAttribute("route")&&(e.innerHTML="")})),n===window.location.hash?s.innerHTML=t.innerHTML:(e.innerHTML="",window.location.hash=document.querySelector("html").getAttribute("root"))}}u="#"+u,window.location.hash="#"+document.querySelector("html").getAttribute("root"),d(),window.addEventListener("hashchange",(()=>{document.querySelector("html").setAttribute("root",window.location.hash.split("#")[1]),d()}))}))}};document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{document.body.style.visibility="visible"}),200)}));