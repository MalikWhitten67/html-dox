let e,t,r,n=[],o=document.querySelector("imports"),i=document.querySelector("[imports]");if(i)r=i.getAttribute("imports").replace(/\s/g,"");else if(o)throw new Error('<imports> is deprecated use <meta imports="/someimport,/someimport"> instead! read latest git release for more info: https://github.com/MalikWhitten67/html-dox/releases/latest');r=r.split(","),r=r.filter(Boolean);let l={},a=[],s={"dox:string":String,"dox:number":Number,"dox:boolean":Boolean,"dox:array":Array,"dox:object":Object,"dox:undefined":void 0,"dox:null":null,"dox:function":Function,"dox:regexp":RegExp,"dox:date":Date},c=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):{};r.map((e=>{if(!(e.endsWith(".html")||e.endsWith(".css")||e.endsWith(".js")))throw new Error("Unsupported imported file type!");if(e.endsWith(".js")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/javascript",t.setAttribute("as","script"),document.querySelector("head").appendChild(t),l[e]?l[e]:fetch(e).then((e=>e.text())).then((t=>{if(t.includes("document")&&!e.includes("tailwind.js"))throw new Error("Imported JS file cannot contain document. Use dox instead.");if((t.includes("innerHTML")||t.includes("innerText"))&&!e.endsWith("tailwind.js"))throw new Error("Use dox:text to return text and dox:$ to return HTML.");let r=document.createElement("script");r.id="dox-script",r.type="module",r.innerHTML=t,document.head.appendChild(r)}))}if(e.endsWith(".html")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/html",t.setAttribute("as","document"),document.querySelector("head").appendChild(t),l[e]?u(l[e]):fetch(e).then((e=>e.text())).then((async t=>{l[e]=t,await u(t)}))}}));const u=async r=>{let o=(new DOMParser).parseFromString(r,"text/html");o=o.body;let i=document.body;o.querySelectorAll("var").forEach((e=>{let t=e.getAttribute("name"),r=e.innerHTML;e.innerHTML.length>0?window[t]=r:window[t]="",o.innerHTML=o.innerHTML.replace(`{{${t}}}`,r),e.remove()})),o.querySelectorAll("*").forEach((async e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.match(/{{(.*?)}}/gs);t&&t.forEach((async e=>{let t=e.split("{{")[1].split("}}}")[0].trim();if(t.startsWith("map(")&&t.endsWith("}}")){e=e.replace("&gt;",">");let n=t.split("map(")[1].split(")")[0],i=e.split("return(")[1].split("){")[0].trim(),l=e.split("){")[1].trim().split("}}")[0].trim();l=l.replace(/json\./g,"");let a=document.createElement("div");async function r(e){let t,r;if(e&&e.data&&e.data.name==n){a.innerHTML="",t=e.data.name,r=e.data.value,parsed=JSON.parse(JSON.stringify(window[t]));let c,u;function s(e){return new Promise((t=>{if(document.querySelector(e))return t(document.querySelector(e));const r=new MutationObserver((n=>{document.querySelector(e)&&(t(document.querySelector(e)),r.disconnect())}));r.observe(document.body,{childList:!0,subtree:!0})}))}i.length>0?(c=new Function("json",`return ${n}.${i}`),u=c(parsed)):u=parsed,u.forEach((e=>{let t,r=l;Object.entries(e).forEach((([e,t])=>{r=r.replace(new RegExp(`{${e}}`,"g"),t)})),t=r,a.innerHTML=a.innerHTML+t}));let d=await s(`[map="${n}"]`);if(d){let p=document.createElement("div");p.innerHTML=a.innerHTML,p.setAttribute("container-map",n),d.querySelector(`[container-map="${n}"]`)?d.querySelector(`[container-map="${n}"]`).innerHTML=a.innerHTML:d.appendChild(p)}o.innerHTML.includes("{{")&&(o.innerHTML=o.innerHTML.replace(/{{(.*?)}}/gs,""))}else if(window[n]){a.innerHTML="";let h,y,f=JSON.parse(window[n]);function s(e){return new Promise((t=>{if(document.querySelector(e))return t(document.querySelector(e));const r=new MutationObserver((n=>{document.querySelector(e)&&(t(document.querySelector(e)),r.disconnect())}));r.observe(document.body,{childList:!0,subtree:!0})}))}i.length>0?(h=new Function("json",`return ${n}.${i}`),y=h(f)):y=f,y.forEach((e=>{let t,r=l;Object.entries(e).forEach((([e,t])=>{r=r.replace(new RegExp(`{${e}}`,"g"),t)})),t=r,a.innerHTML=a.innerHTML+t}));let m=await s(`[map="${n}"]`);if(m)if(0==m.innerHTML.length)m.innerHTML=a.innerHTML;else if(m.innerHTML.length>0)if(m.querySelector(`[container-map="${n}"]`))m.querySelector(`[container-map="${n}"]`).innerHTML=a.innerHTML;else{let w=document.createElement("div");w.innerHTML=a.innerHTML,w.setAttribute("container-map",n),m.appendChild(w)}}}r(),window.addEventListener("message",(e=>{e.origin==window.location.origin&&"setVar"==e.data.type&&(o.querySelectorAll("var").forEach((t=>{if(t.hasAttribute("typeof")){let r=t.getAttribute("typeof").split("{{:")[1].split("}}")[0],n=e.data.data.value;if("<Json>"===r)try{JSON.parse(n)}catch(e){throw new Error(`Invalid value for type "${r}": ${n} (expected JSON)`)}else if("<String>"===r){if("true"===n||"false"===n||"null"===n)throw new Error(`Invalid value for type "${r}": ${n} (expected string)`)}else if("<Number>"===r){if(isNaN(parseFloat(n))||!isFinite(n))throw new Error(`Invalid value for type "${r}": ${n} (expected number)`)}else if("<Boolean>"===r){if("true"!==n&&"false"!==n)throw new Error(`Invalid value for type "${r}": ${n} (expected boolean)`)}else{if("<Array>"!==r)throw new Error(`Unsupported type: ${r}`);try{let e=JSON.parse(n);if(!Array.isArray(e))throw new Error(`Invalid value for type "${r}": ${n} (expected array)`)}catch(e){throw new Error(`Invalid value for type "${r}": ${n} (expected array)`)}}}t.remove()})),r(e))}))}}))}})),o.querySelectorAll("import").forEach((e=>{let t=e.getAttribute("src");if(!t.endsWith(".html"))throw new Error("Unsupported imported file type!");window[t]?d(window[t],o,i,e):fetch(t).then((e=>e.text())).then((r=>{window[t]=r,d(r,o,i,e)}))}));let l=o.querySelector("export");l&&(l=l.innerHTML.replace(/\s/g,""),l=l.split(","),l=l.filter(Boolean),l.forEach((async r=>{let l=o.querySelector(r);if([].forEach((e=>{if(l.hasAttribute(e)&&"typeof"===e){let t=a.find((t=>t.name===l.getAttribute(e)));if(!t)throw new Error(`Type "${l.getAttribute(e)}" does not exist`);{let e,n=s[t.constraint],o=i.querySelector(r).innerHTML;if("false"===t.isStrict)return;if(n===Number){if(e=Number(o),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid value for type "${t.name}": ${o} (expected number)`)}else if(n===Boolean)if("true"===o.toLowerCase())e=!0;else{if("false"!==o.toLowerCase())throw new Error(`Invalid value for type "${t.name}": ${o} (expected boolean)`);e=!1}else{if(n!==String)throw new Error(`Invalid constraint type for type "${t.name}": ${t.constraint}`);e=o}}}})),o.querySelectorAll("[state]").forEach((e=>{let t=e.getAttribute("state");e.id=t,null!=y(t)&&null!=y(t)||h(t,""),e.innerHTML=e.innerHTML+y(t),setTimeout((()=>{f(t,(r=>{setTimeout((()=>{"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.value=r),"SELECT"==e.tagName&&(e.value=r),"IMG"==e.tagName&&(e.src=r),"A"==e.tagName&&(e.href=r),"IFRAME"==e.tagName&&(e.src=r),"VIDEO"==e.tagName&&(e.src=r),"AUDIO"==e.tagName&&(e.src=r),"EMBED"==e.tagName&&(e.src=r),"OBJECT"==e.tagName&&(e.src=r),"SOURCE"==e.tagName&&(e.src=r),"TRACK"==e.tagName?e.src=r:e.innerHTML=r,document.querySelector(`#${t}`).innerHTML=r}),0)}))}),0)})),window.rerender=u,o.querySelector(r).hasAttribute("props")){o.querySelector(r);let e=o.querySelector(r).getAttribute("props").split(":");e.forEach((t=>{if(c[r]=e,sessionStorage.setItem("$dox-props",JSON.stringify(c)),l.querySelectorAll("[derive]").forEach((e=>{let t=e.getAttribute("derive"),n=i.querySelector(r).getAttribute(t);e.innerHTML.includes(`{{${t}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t}}}`,n))})),"children"==t){if(o.querySelector(r).querySelector("slot")&&o.querySelector(r).innerHTML.includes("{{children}}")){let e=o.querySelector(r).querySelector("slot").innerHTML;o.querySelector(r).innerHTML=o.querySelector(r).innerHTML.replace("{{children}}",e)}}else i.querySelector(r).getAttribute(t)&&(o.querySelector(r).innerHTML=o.querySelector(r).innerHTML.replace(`{{${t}}}`,i.querySelector(r).getAttribute(t)))})),o.querySelectorAll("[props]").forEach((e=>{e.getAttribute("props").split(":").forEach((t=>{if(e.hasAttribute("typeof")){let r=e.getAttribute("typeof").split("{{:")[1].split("}}")[0],n=e.getAttribute(t);if("<Json>"===r)try{JSON.parse(n)}catch(e){throw new Error(`Invalid value for type "${r}": ${n} (expected JSON)`)}else if("<String>"===r){if("true"===n||"false"===n||"null"===n)throw new Error(`Invalid value for type "${r}": ${n} (expected string)`)}else if("<Number>"===r){if(isNaN(parseFloat(n))||!isFinite(n))throw new Error(`Invalid value for type "${r}": ${n} (expected number)`)}else if("<Boolean>"===r){if("true"!==n&&"false"!==n)throw new Error(`Invalid value for type "${r}": ${n} (expected boolean)`)}else{if("<Array>"!==r)throw new Error(`Unsupported type: ${r}`);try{let e=JSON.parse(n);if(!Array.isArray(e))throw new Error(`Invalid value for type "${r}": ${n} (expected array)`)}catch(e){throw new Error(`Invalid value for type "${r}": ${n} (expected array)`)}}}}))}))}function u(e){let t=document.querySelector(e);t&&n.forEach((e=>{if(e.element==t){e.html.querySelectorAll("import").forEach((async e=>{let t=e.getAttribute("src");if(!t.endsWith(".html"))throw new Error("Unsupported imported file type!");window[t]?d(window[t],o,document.body,e):fetch(t).then((e=>e.text())).then((async r=>{await setTimeout((()=>{}),0),window[t]=r,d(r,o,document.body,e)}))}))}}))}function p(e){e.inject=t=>(e.innerHTML=t,p(e));let t=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):[];return t=t[e.tagName],t&&(e.props=t),e.class=t=>(e.className=t,p(e)),e.add=(t,r)=>{let n=document.createElement(t);return r&&Object.keys(r).forEach((e=>{n.setAttribute(e,r[e])})),e.appendChild(n),p(n)},e.delete=()=>(e.remove(),p(e)),e.parent=()=>p(e.parentNode),e.query=e=>{let t=document.querySelector(e);if(t)return p(t)},e.classes=(t,r)=>("add"==r&&e.classList.add(t),"remove"==r&&e.classList.remove(t),"toggle"==r&&e.classList.toggle(t),p(e)),e.html=t=>t?(e.innerHTML=t,p(e)):e.innerHTML,e.prepend=t=>(e.innerHTML=t+e.innerHTML,p(e)),e.append=t=>(e.innerHTML+=t,p(e)),e.blur=()=>{e.blur()},e.fade=t=>{e.style.transition=`opacity ${t}s`,e.style.opacity=0},e.focus=e.focus,e.queryAll=t=>{let r=e.querySelectorAll(t);return e.forEach=e=>{r.forEach((t=>{e(t)}))},r.forEach((e=>{e=p(e)})),r},e.after=t=>(e.insertAdjacentHTML("afterend",t),p(e)),e.before=t=>(e.insertAdjacentHTML("beforebegin",t),p(e)),e.attr=(t,r)=>r?(e.setAttribute(t,r),p(e)):e.getAttribute(t),e.replace=(t,r)=>{let n=document.createElement(t);return n.innerHTML=r,e.parentNode.replaceChild(n,e),p(n)},e.on=(t,r)=>{e.addEventListener(t,(t=>(Object.defineProperty(t,"target",{value:p(t.target)}),Object.defineProperty(t,"currentTarget",{value:p(t.currentTarget)}),r(t),p(e))))},e.setProp=(t,r)=>{if(r)return o.querySelector(e.tagName).setAttribute(t,r),u(),p(e)},e.css=(t,r)=>r?(e.style[t]=r,p(e)):e.style[t],e.getChildren=()=>{let t=[],r=e=>{let n=e.children;for(let o=0;o<n.length;o++)n[o]=p(n[o]),n[o].parent=e,n[o].index=o,t.push(n[o]),r(n[o])};return e.forEach=r=>(t.forEach((e=>{r(e)})),p(e)),e.map=(r,n)=>(n?t.forEach((e=>{r(e,n)})):t.forEach((e=>{r(e)})),p(e)),r(e),t},e}document.querySelector(r)&&n.push({element:document.querySelector(r),parent:document.querySelector(r).parentNode,template:l.innerHTML,html:o,body:i}),u(),e={route:()=>window.currentRoute,currentRender:()=>t,setProp:(e,t,r)=>{let n=o.querySelector(e);return n&&(n.setAttribute(t,r),u()),p(n)},current:()=>{let e=document.activeElement;if(e)return e.isActive=!0,p(e)},domChange:(e,t=!1,r=(()=>{}))=>{var n=!1;new MutationObserver((function(t){n&&"changed"===e?t.forEach((function(e){r(e)})):r()})).observe(document,{childList:!0,subtree:!0}),setTimeout((()=>{n=!0,t&&r()}),100)},setVar:(e,t)=>{window[e]=t,window.postMessage({type:"setVar",data:{name:e,value:t}},window.location.origin)},add:(e,t)=>{let r=document.createElement(e);return Object.keys(t).forEach((e=>{r.setAttribute(e,t[e])})),r=p(r),p(r)},title:e=>{document.title=e},querySelector:e=>{let t=document.querySelector(e);return t&&(t=p(t)),t},querySelectorAll:e=>{let r=t.querySelectorAll(e)||o.querySelectorAll(e)||i.querySelectorAll(e)||null,n=[];return r.forEach((e=>{n.push(p(e))})),n},html:document.querySelector("html").innerHTML,text:document.querySelector("html").innerText,on:(e,t)=>{window.addEventListener(e,t)},post:(e,t,r,n)=>{"object"==typeof t?(t=JSON.stringify(t),fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text()))):"string"==typeof t?fetch(e,{method:"POST",headers:{"Content-Type":"text/plain",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text())).then((e=>{r(e)})):JSON.parse(t)&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},get:(e,t,r)=>{fetch(e,{method:"GET",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))},put:(e,t,r,n)=>{fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},delete:(e,t,r)=>{fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))},setMeta:(e=null,t=null,r,n=!1,o=!1)=>{if(t){if(o&&(r.includes("https")||r.includes("http")))return void(r+="?a=b");if(document.querySelector(`meta[property="${t}"]`))return document.querySelector(`meta[property="${t}"]`).setAttribute("content",r),void(n&&document.querySelector(`meta[property="${t}"]`).setAttribute(n,r));{let i=document.createElement("meta");if(o&&(r.includes("https")||r.includes("http")))return void(r+="?a=b");n&&Object.keys(n).forEach((e=>{cosole.log(e),i.setAttribute(e,n[e])})),i.setAttribute("property",t),i.setAttribute("content",r),e&&i.setAttribute("name",e),document.querySelector("head").appendChild(i)}}else if(e){let t=document.createElement("meta");t.setAttribute("name",e),t.setAttribute("content",r),n&&Object.keys(n).forEach((e=>{t.setAttribute(e,n[e])})),document.querySelector("head").appendChild(t)}}}}))),o.querySelectorAll("var").forEach((e=>{if(e.hasAttribute("typeof")){let t=e.getAttribute("typeof").split("{{:")[1].split("}}")[0],r=e.innerHTML;if("<Json>"===t)try{JSON.parse(r)}catch(e){throw new Error(`Invalid value for type "${t}": ${r} (expected JSON)`)}else if("<String>"===t){if("true"===r||"false"===r||"null"===r)throw new Error(`Invalid value for type "${t}": ${r} (expected string)`)}else if("<Number>"===t){if(isNaN(parseFloat(r))||!isFinite(r))throw new Error(`Invalid value for type "${t}": ${r} (expected number)`)}else if("<Boolean>"===t){if("true"!==r&&"false"!==r)throw new Error(`Invalid value for type "${t}": ${r} (expected boolean)`)}else{if("<Array>"!==t)throw new Error(`Unsupported type: ${t}`);try{let e=JSON.parse(r);if(!Array.isArray(e))throw new Error(`Invalid value for type "${t}": ${r} (expected array)`)}catch(e){throw new Error(`Invalid value for type "${t}": ${r} (expected array)`)}}}}))};async function d(e,t,r,n){let o=new DOMParser,i=await o.parseFromString(e,"text/html").body,l={};if(i.querySelectorAll("var").forEach((e=>{e.style.display="none";let t=e.getAttribute("name"),r=e.innerHTML;window[t]=r,i.innerHTML=i.innerHTML.replace(`{{${t}}}`,r),e.remove()})),i.querySelector("if")){let e=i.querySelector("if"),r=e.getAttribute("prop")?e.getAttribute("prop"):null,n=e.getAttribute("is"),o=(e.getAttribute("else"),e.parentNode),l=e.getAttribute("props")?e.getAttribute("props").split(","):null,a=t.querySelector(o.tagName);r&&l&&l.forEach((t=>{if(a.getAttribute(r)==n){let t=e.innerHTML;if(t.includes("{{")){let e=t.split("{{")[1].split("}}")[0];parsedjs(e,o)}}}))}i.querySelectorAll("var").forEach((e=>{e.style.display="none";let r=e.getAttribute("name"),n=e.innerHTML;if(window[r]=n,t.querySelectorAll("*").forEach((e=>{let t=e.innerHTML.match(/{{(.*?)}}/g);t&&e.innerHTML.includes(`{{${r}}}`)&&t.forEach((t=>{e.innerHTML=e.innerHTML.replace(t,n)}))})),e.hasAttribute("typeof")){let t=e.getAttribute("typeof").split("{{:")[1].split("}}")[0],r=n;if("<Json>"===t)try{JSON.parse(r)}catch(e){throw new Error(`Invalid value for type "${t}": ${r} (expected JSON)`)}else if("<String>"===t){if("true"===r||"false"===r||"null"===r)throw new Error(`Invalid value for type "${t}": ${r} (expected string)`)}else if("<Number>"===t){if(isNaN(parseFloat(r))||!isFinite(r))throw new Error(`Invalid value for type "${t}": ${r} (expected number)`)}else if("<Boolean>"===t){if("true"!==r&&"false"!==r)throw new Error(`Invalid value for type "${t}": ${r} (expected boolean)`)}else{if("<Array>"!==t)throw new Error(`Unsupported type: ${t}`);try{let e=JSON.parse(r);if(!Array.isArray(e))throw new Error(`Invalid value for type "${t}": ${r} (expected array)`)}catch(e){throw new Error(`Invalid value for type "${t}": ${r} (expected array)`)}}}e.remove()}));let a=[];if(i.querySelectorAll("[props]").forEach((async e=>{let r=e.tagName;if(t.querySelector(r)){let n=e.getAttribute("props").split(":");n.forEach((async e=>{if(l[r]=n,sessionStorage.setItem("$dox-props",JSON.stringify(l)),"children"==e)t.querySelector(r).querySelector("slot")&&i.querySelector(r).innerHTML.includes("{{children}}")&&(a.length>0&&a.forEach((e=>{e.parent==i.querySelector(r).parentNode&&(i.querySelector(r).innerHTML=e.template)})),a.push({element:i.querySelector(r),template:i.querySelector(r).innerHTML,parent:i.querySelector(r).parentNode?i.querySelector(r).parentNode:null}),i.querySelector(r).innerHTML=i.querySelector(r).innerHTML.replace("{{children}}",t.querySelector(r).querySelector("slot").innerHTML));else if(t.querySelector(r).getAttribute(e)&&(a.length>0&&a.forEach((n=>{i.querySelector(r).innerHTML.includes(`{{${e}}}`)&&(i.querySelector(r).innerHTML=i.querySelector(r).innerHTML.replace(`{{${e}}}`,t.querySelector(r).getAttribute(e)))})),i.querySelector(r).innerHTML.includes(`{{${e}}}`))){a.push({element:i.querySelector(r),template:i.querySelector(r).innerHTML,parent:i.querySelector(r).parentNode?i.querySelector(r).parentNode:null});let n=t.querySelector(r).getAttribute(e);i.querySelector(r).innerHTML=i.querySelector(r).innerHTML.replace(`{{${e}}}`,n)}}))}})),i.querySelectorAll("*").forEach((e=>{Object.values(e.attributes).forEach((t=>{let r=t.value;if(r.includes("{{")){let n=r.match(/{{(.*?)}}/g);n&&(n.forEach((t=>{let n=t.replace("{{","").replace("}}",""),o=e.parentNode.getAttribute(n),i=document.querySelector(e.parentNode.tagName);i&&i.getAttribute(n)&&(o=i.getAttribute(n)),r=r.replace(new RegExp(`{{${n}}}`,"g"),o)})),e.setAttribute(t.name,r))}}));let r=e.innerHTML.match(/{{(.*?)}}/g);if(r&&r.forEach((r=>{let n=r.split("{{")[1].split("}}")[0],o=i.querySelector(e.tagName).parentNode.tagName;t.querySelectorAll("*").forEach((t=>{if(t.tagName==o){let r=t.getAttribute(n);if(r){"true"==r.toString().toLowerCase()&&(r=r.toString().toLowerCase());let t=e.innerHTML.replace(new RegExp(`{{${n}}}`,"g"),r);e.innerHTML=t}}}))})),e.hasAttribute("state")){let t=e.getAttribute("state");e.innerHTML=e.innerHTML+y(t),document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=e.innerHTML),f(t,(t=>{document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=t)}))}})),n.getAttribute("exports")){n.getAttribute("exports").split(",").forEach((async e=>{let r=i.querySelector(e)?i.querySelector(e):t.querySelector(e);var n;(await(n=e,new Promise((e=>{if(document.querySelector(n))return e(document.querySelector(n));const t=new MutationObserver((r=>{document.querySelector(n)&&(e(document.querySelector(n)),t.disconnect())}));t.observe(document.body,{childList:!0,subtree:!0})})))).innerHTML=r.innerHTML}))}}window.Router=class{constructor(e){this.routes=e||{},this.currentRoute="",window.addEventListener("hashchange",(()=>{this.route(),rerender()})),window.addEventListener("DOMContentLoaded",(()=>{this.route()})),this.fallbackRoute="",this.errorOn=!1}route(){const e=window.location.hash.slice(1);this.currentRoute=e,this.navigate()}render(t){n.forEach((r=>{let n=r.parent,o=r.template,i=r.element;if(n.getAttribute("route")===t){i.innerHTML="",window.dox=e,document.title=n.getAttribute("title"),window.rerender(i.tagName),window.currentRender=i;let t=(new DOMParser).parseFromString(o,"text/html");t.body.innerHTML=t.body.innerHTML.replace(/{{(.*?)}}}/gs,""),i.innerHTML=t.body.innerHTML}else i.innerHTML=""}))}navigate(){let e=!1;this.routes&&Object.keys(this.routes).forEach((async t=>{const{isMatch:r,params:n,query:o,asterisk:i}=this.isRouteMatch(this.currentRoute,t);if(r){if(e=!0,Object.keys(o).length>0&&window.location.hash.includes("?")){t=window.location.hash.split("?")[0].replace("#","");const e=this.routes[t];return this.render(t),await setTimeout((()=>{}),2),e({params:n,query:o}),void(window.dox=window.dox||{})}if(Object.keys(n).length>0&&!window.location.hash.includes("?")){const e=this.routes[t],r=t.split("/:")[0];return this.render(r),await setTimeout((()=>{}),2),e({params:n,query:o}),void(window.dox=window.dox||{})}if(i){const e=this.routes[t],r=t.split("/*")[0];return this.render(r),await setTimeout((()=>{}),2),e({asterisk:i}),void(window.dox=window.dox||{})}{const e=this.routes[t];return this.render(t),await setTimeout((()=>{}),2),e({params:n,query:o}),void(window.dox=window.dox||{})}}this.render("404")})),!e&&this.fallbackRoute&&(window.location.hash="#"+this.fallbackRoute)}isRouteMatch(e,t){const r=e.split("/").filter((e=>""!==e)),n=t.split("/").filter((e=>""!==e));if(r.length!==n.length&&!t.includes("*"))return{isMatch:!1};const o={};let i={},l="";for(let e=0;e<n.length;e++){const t=r[e],a=n[e];if(a.startsWith(":")){const e=t;o[a.slice(1)]=e}else if(a.includes("?")){const e=a.split("?")[1];i=this.extractQuery(e)}else{if(a.includes("*")){l=r.slice(e).join("/");break}if(t!==a)return{isMatch:!1}}}return{isMatch:!0,params:o,query:i,asterisk:l}}get(e,t){this.routes[e]=t}redirect(e){window.location.hash="#"+e}extractParams(e,t){const r=e.split("/").filter((e=>""!==e)),n=t.split("/").filter((e=>""!==e)),o={};for(let e=0;e<n.length;e++){const t=n[e];if(t.startsWith(":")){const n=t.slice(1),i=r[e];o[n]=i}}return o}extractQuery(e){const t=e.indexOf("?");if(-1!==t){const r=e.slice(t+1).split("&"),n={};return r.forEach((e=>{const[t,r]=e.split("=");n[t]=decodeURIComponent(r)})),n}return{}}extractAsterics(e){const t=e.indexOf("*");if(-1!==t){const r=e.slice(t+1).split("&"),n={};return r.forEach((e=>{const[t,r]=e.split("=");n[t]=decodeURIComponent(r)})),n}}},window.dox=e;const p={},h=(e,t)=>{p[e]=t,window.postMessage({name:e,value:t},"*")},y=e=>p[e];window.addEventListener("message",(e=>{if(e.origin!==window.location.origin)return;const{name:t,value:r}=e.data;p[t]=r}));const f=(e,t=(()=>{}))=>{window.addEventListener("message",(r=>{if(r.origin!==window.location.origin)return;const{name:n,value:o}=r.data;n===e&&t(o)}))};window.effect=f,window.getState=y,window.setState=h,window.dox=e;