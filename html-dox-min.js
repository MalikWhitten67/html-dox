let dox,currentRender,templates=[],importsTag=document.querySelector("imports"),importmeta=document.querySelector("[imports]"),imports;if(importmeta)imports=importmeta.getAttribute("imports").replace(/\s/g,"");else if(importsTag)throw new Error('<imports> is deprecated use <meta imports="/someimport,/someimport"> instead! read latest git release for more info: https://github.com/MalikWhitten67/html-dox/releases/latest');imports=imports.split(","),imports=imports.filter(Boolean);let cache={},types=[],contraintTypes={"dox:string":String,"dox:number":Number,"dox:boolean":Boolean,"dox:array":Array,"dox:object":Object,"dox:undefined":void 0,"dox:null":null,"dox:function":Function,"dox:regexp":RegExp,"dox:date":Date},variables=[],props=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):{};const parser=async e=>{let t=(new DOMParser).parseFromString(e,"text/html");t=t.body;let r=document.body;t.querySelectorAll("import").forEach((e=>{let n=e.getAttribute("src");if(!n.endsWith(".html"))throw new Error("Unsupported imported file type!");window[n]?setData(window[n],t,r,e):fetch(n).then((e=>e.text())).then((i=>{window[n]=i,setData(i,t,r,e)}))}));let n=t.querySelector("export");n.style.display="none",t.querySelectorAll("var").forEach((e=>{e.style.display="none";let r=e.getAttribute("name"),n=e.innerHTML;if(window[r]=n,e.html,window[r+"Element"]=e,e.hasAttribute("state")){let t=e.getAttribute("state");null!=getState(t)&&null!=getState(t)||setState(t,""),effect(t,(t=>{setTimeout((()=>{e.innerHTML=t}),0)}))}t.querySelectorAll("*").forEach((t=>{let i=t.innerHTML.match(/{{(.*?)}}/g),o=t.outerHTML.match(/{{(.*?)}}/g);t.innerHTML;o?o.forEach((e=>{e.split("{{")[1].split("}}")[0]==r&&t.parentNode&&(t.outerHTML=t.outerHTML.replace(e,n))})):i&&t.innerHTML.includes(`{{${r}}}`)?i.forEach((r=>{window.onmessage=t=>{if(t.origin==window.location.origin&&"setVar"==t.data.type){let r=t.data.name,n=t.data.value;e.getAttribute("name")==r&&(window[r]=n,e.innerHTML=n)}},t.innerHTML=t.innerHTML.replace(r,JSON.parse(e.innerHTML))})):window.onmessage=t=>{if(t.origin==window.location.origin&&"setVar"==t.data.type){let r=t.data.name,n=t.data.value;e.getAttribute("name")==r&&(window[r]=n,e.innerHTML=n)}}})),e.remove()})),n&&(n=n.innerHTML.replace(/\s/g,""),n=n.split(","),n=n.filter(Boolean),n.forEach((async e=>{function n(e){e.inject=t=>(e.innerHTML=t,n(e));let r=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):[];return r=r[e.tagName],r&&(e.props=r),e.class=t=>(e.className=t,n(e)),e.add=(t,r)=>{let i=document.createElement(t);return r&&Object.keys(r).forEach((e=>{i.setAttribute(e,r[e])})),e.appendChild(i),n(i)},e.delete=()=>(e.remove(),n(e)),e.parent=()=>n(e.parentNode),e.query=e=>{let t=document.querySelector(e);if(t)return n(t)},e.classes=(t,r)=>("add"==r&&e.classList.add(t),"remove"==r&&e.classList.remove(t),"toggle"==r&&e.classList.toggle(t),n(e)),e.html=t=>t?(e.innerHTML=t,n(e)):e.innerHTML,e.prepend=t=>(e.innerHTML=t+e.innerHTML,n(e)),e.append=t=>(e.innerHTML+=t,n(e)),e.blur=()=>{e.blur()},e.fade=t=>{e.style.transition=`opacity ${t}s`,e.style.opacity=0},e.focus=e.focus,e.queryAll=t=>{let r=e.querySelectorAll(t);return e.forEach=e=>{r.forEach((t=>{e(t)}))},r.forEach((e=>{e=n(e)})),r},e.after=t=>(e.insertAdjacentHTML("afterend",t),n(e)),e.before=t=>(e.insertAdjacentHTML("beforebegin",t),n(e)),e.attr=(t,r)=>r?(e.setAttribute(t,r),n(e)):e.getAttribute(t),e.replace=(t,r)=>{let i=document.createElement(t);return i.innerHTML=r,e.parentNode.replaceChild(i,e),n(i)},e.on=(t,r)=>{e.addEventListener(t,(t=>(Object.defineProperty(t,"target",{value:n(t.target)}),Object.defineProperty(t,"currentTarget",{value:n(t.currentTarget)}),r(t),n(e))))},e.setProp=(r,i)=>{if(i)return t.querySelector(e.tagName).setAttribute(r,i),o(),n(e)},e.css=(t,r)=>r?(e.style[t]=r,n(e)):e.style[t],e.getChildren=()=>{let t=[],r=e=>{let i=e.children;for(let o=0;o<i.length;o++)i[o]=n(i[o]),i[o].parent=e,i[o].index=o,t.push(i[o]),r(i[o])};return e.forEach=r=>(t.forEach((e=>{r(e)})),n(e)),e.map=(r,i)=>(i?t.forEach((e=>{r(e,i)})):t.forEach((e=>{r(e)})),n(e)),r(e),t},e}dox={route:()=>window.currentRoute,currentRender:()=>currentRender,setProp:(e,r,i)=>{let l=t.querySelector(e);return l&&(l.setAttribute(r,i),o()),n(l)},setVar:(e,t)=>{window[e]=t,window.postMessage({type:"setVar",name:e,value:t},window.location.origin)},current:()=>{let e=document.activeElement;if(e)return e.isActive=!0,n(e)},domChange:(e,t=!1,r=(()=>{}))=>{var n=!1;new MutationObserver((function(t){n&&"changed"===e?t.forEach((function(e){r(e)})):r()})).observe(document,{childList:!0,subtree:!0}),setTimeout((()=>{n=!0,t&&r()}),100)},add:(e,t)=>{let r=document.createElement(e);return Object.keys(t).forEach((e=>{r.setAttribute(e,t[e])})),r=n(r),n(r)},title:e=>{document.title=e},querySelector:e=>{let t=document.querySelector(e);return t&&(t=n(t)),t},querySelectorAll:e=>{let i=currentRender.querySelectorAll(e)||t.querySelectorAll(e)||r.querySelectorAll(e)||null,o=[];return i.forEach((e=>{o.push(n(e))})),o},html:document.querySelector("html").innerHTML,text:document.querySelector("html").innerText,on:(e,t)=>{window.addEventListener(e,t)},post:(e,t,r,n)=>{"object"==typeof t?(t=JSON.stringify(t),fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text()))):"string"==typeof t?fetch(e,{method:"POST",headers:{"Content-Type":"text/plain",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text())).then((e=>{r(e)})):JSON.parse(t)&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},get:(e,t,r)=>{fetch(e,{method:"GET",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))},put:(e,t,r,n)=>{fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},delete:(e,t,r)=>{fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))},setMeta:(e=null,t=null,r,n=!1,i=!1)=>{if(t){if(i&&(r.includes("https")||r.includes("http")))return void(r+="?a=b");if(document.querySelector(`meta[property="${t}"]`))return document.querySelector(`meta[property="${t}"]`).setAttribute("content",r),void(n&&document.querySelector(`meta[property="${t}"]`).setAttribute(n,r));{let o=document.createElement("meta");if(i&&(r.includes("https")||r.includes("http")))return void(r+="?a=b");n&&Object.keys(n).forEach((e=>{cosole.log(e),o.setAttribute(e,n[e])})),o.setAttribute("property",t),o.setAttribute("content",r),e&&o.setAttribute("name",e),document.querySelector("head").appendChild(o)}}else if(e){let t=document.createElement("meta");t.setAttribute("name",e),t.setAttribute("content",r),n&&Object.keys(n).forEach((e=>{t.setAttribute(e,n[e])})),document.querySelector("head").appendChild(t)}}},window.dox=dox;let i=t.querySelector(e);[].forEach((t=>{if(i.hasAttribute(t)&&"typeof"===t){let n=types.find((e=>e.name===i.getAttribute(t)));if(!n)throw new Error(`Type "${i.getAttribute(t)}" does not exist`);{let t,i=contraintTypes[n.constraint],o=r.querySelector(e).innerHTML;if("false"===n.isStrict)return;if(i===Number){if(t=Number(o),t=isNaN(t)?0:t,0===t)throw new Error(`Invalid value for type "${n.name}": ${o} (expected number)`)}else if(i===Boolean)if("true"===o.toLowerCase())t=!0;else{if("false"!==o.toLowerCase())throw new Error(`Invalid value for type "${n.name}": ${o} (expected boolean)`);t=!1}else{if(i!==String)throw new Error(`Invalid constraint type for type "${n.name}": ${n.constraint}`);t=o}}}}));if(t.querySelectorAll("[state]").forEach((e=>{let t=e.getAttribute("state");e.id=t,null!=getState(t)&&null!=getState(t)||setState(t,""),e.innerHTML=e.innerHTML+getState(t),setTimeout((()=>{effect(t,(r=>{setTimeout((()=>{"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.value=r),"SELECT"==e.tagName&&(e.value=r),"IMG"==e.tagName&&(e.src=r),"A"==e.tagName&&(e.href=r),"IFRAME"==e.tagName&&(e.src=r),"VIDEO"==e.tagName&&(e.src=r),"AUDIO"==e.tagName&&(e.src=r),"EMBED"==e.tagName&&(e.src=r),"OBJECT"==e.tagName&&(e.src=r),"SOURCE"==e.tagName&&(e.src=r),"TRACK"==e.tagName?e.src=r:e.innerHTML=r,document.querySelector(`#${t}`).innerHTML=r}),0)}))}),0)})),t.querySelectorAll("*").forEach((async e=>{if(e.innerHTML.includes("{{")){let r=e.innerHTML.match(/{{(.*?)}}/g);e.innerHTML;if(r){let i=r[0].split("{{")[1].split("}}")[0];if(i.includes("json.map(")){let o=i.split("json.map(")[1].split(")")[0],l=i.split("json.map(")[1].split(")")[0].split(".")[1];if(o=i.split("json.map(")[1].split(")")[0].split(".")[0],(window[o]||window[o+"Element"])&&i.includes("return")){function t(t){e=t;let n,a=document.createElement("div"),s=i.split("return(")[1].split(")")[0].replace(/'/g,"");try{n=JSON.parse(window[o])}catch(e){console.log(e)}n.forEach((e=>{let t;if(s.includes("[")){let e=s.split("[")[0],r=s.split("[")[1].split("]")[0],n=r.split("=")[1].replace(/'/g,"").replace(/"/g,""),i=r.split("=")[0];t=document.createElement(e),t.setAttribute(i,n)}else if(s.includes(".")){t=document.createElement(s.split(".")[0]);let e=s.split("."),r=e.find((e=>e.includes("style")));if(r)r=r.split("(")[1].split(")")[0].split(";"),r.forEach((e=>{if(e.trim()){let[r,n]=e.split(":");r=r.trim(),n=n.trim(),t.style[r]=n}}));else{let r=e.find((e=>e.includes("class")));r&&(r=r.split("(")[1].split(")")[0],t.className=r)}}else if(s.includes("#")){let e=s.split("#")[1];t=document.createElement(s.split("#")[0]),t.setAttribute("id",e)}else t=document.createElement(s);t.innerHTML="",t.innerHTML=t.innerHTML+e[l],a.append(t)})),e.id=o,e.setAttribute("id",r[0]),document.querySelector(e.tagName)?(document.querySelector(e.tagName).innerHTML="",document.querySelector(e.tagName).append(a)):e.innerHTML=e.innerHTML.replace(r[0],a.innerHTML)}window[o+"Element"].innerHTML.length>0?t(e):window.onmessage=r=>{if(r.origin==window.location.origin&&"setVar"==r.data.type){let n=r.data.name,i=r.data.value;o==n&&(window[o]=JSON.stringify(i),t(e))}}}}}let n=e.innerHTML.match(/{{(.*?)}}/gs);n&&n.forEach((e=>{let t=e.split("{{")[1].split("}}")[0];if(t.includes("map")&&!t.includes("json.map")){e=e.replace("&gt;",">");let n=new DOMParser,i=t.split("map(")[1].split(")")[0],o=t.split("return(")[1].split(")")[0];o=o.replace("&gt;",">").replace("&gt;",">");let l=e.split("){")[1].trim().split("}}")[0].trim(),a=n.parseFromString(l,"text/html"),s=l.split("<")[1].split(">")[0],c=document.createElement("div");function r(e){let t,r;if(e&&e.data&&(t=e.data.name,r=e.data.value),i==t||window[i]){e&&e.data?window[i]=r:window[i]=JSON.parse(window[i]),c.innerHTML="";let t,n,l=window[i],u=[];o.length>0?(t=new Function("json",`return ${i}.${o})`),n=t(l)):n=l,n.forEach((e=>{let t=document.createElement(s[0]),r=a.body.innerHTML;Object.entries(e).forEach((([e,t])=>{r=r.replace(new RegExp(`{${i}.${e}}`,"g"),t)})),t.innerHTML=r,u.push(t),c.append(t)})),document.querySelector(`[map="${i}"]`).innerHTML=c.innerHTML}}window[i]&&r(),window.addEventListener("message",(e=>{e.origin==window.location.origin&&"setVar"==e.data.type&&r(e)}))}}))}})),window.rerender=o,t.querySelector(e).hasAttribute("props")){t.querySelector(e);let n=t.querySelector(e).getAttribute("props").split(":");n.forEach((o=>{if(props[e]=n,sessionStorage.setItem("$dox-props",JSON.stringify(props)),i.querySelectorAll("[derive]").forEach((t=>{let n=t.getAttribute("derive"),i=r.querySelector(e).getAttribute(n);t.innerHTML.includes(`{{${n}}}`)&&(t.innerHTML=t.innerHTML.replace(`{{${n}}}`,i))})),"children"==o){if(t.querySelector(e).querySelector("slot")&&t.querySelector(e).innerHTML.includes("{{children}}")){let r=t.querySelector(e).querySelector("slot").innerHTML;t.querySelector(e).innerHTML=t.querySelector(e).innerHTML.replace("{{children}}",r)}}else r.querySelector(e).getAttribute(o)&&(t.querySelector(e).innerHTML=t.querySelector(e).innerHTML.replace(`{{${o}}}`,r.querySelector(e).getAttribute(o)))}))}function o(r){if(t.querySelector(e)){t.querySelectorAll("import").forEach((async e=>{let r=e.getAttribute("src");if(!r.endsWith(".html"))throw new Error("Unsupported imported file type!");window[r]?(await setTimeout((()=>{}),0),setData(window[r],t,document.body,e)):fetch(r).then((e=>e.text())).then((async n=>{await setTimeout((()=>{}),0),window[r]=n,setData(n,t,document.body,e)}))}))}}document.querySelector(e)&&templates.push({element:document.querySelector(e),parent:document.querySelector(e).parentNode,template:i.innerHTML,html:t,body:r}),o()}))),r.querySelectorAll("type").forEach((e=>{let n=e.querySelectorAll("subtype");types.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!contraintTypes[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");types.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),n.forEach((e=>{if(!contraintTypes[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");types.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),t.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];r.querySelectorAll(`[${t}]`).forEach((r=>{let n=r.getAttribute(t),i=e.getAttribute("subtype"),o=types.find((e=>e.name===i)),l=o.isStrict;if(o&&l){let e,t=contraintTypes[o.constraint];if(t===Number){if(e=Number(n),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${i}": ${n} (expected number)`)}else if(t===Boolean)if("true"===n.toLowerCase())e=!0;else{if("false"!==n.toLowerCase())throw new Error(`Invalid attribute value for subtype "${i}": ${n} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${i}": ${o.constraint}`);e=n}}}))}}))})),t.querySelectorAll("type").forEach((e=>{let n=e.querySelectorAll("subtype"),i=[];n.forEach((t=>{if(i.push(t.getAttribute("name")),i.filter(((e,t)=>i.indexOf(e)!==t)).length>0)throw new Error("Two subtypes cannot have the same name");if(t.getAttribute("name")===e.getAttribute("name"))throw new Error("Types and subtypes cannot have the same name")})),types.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!contraintTypes[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");types.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")})})),t.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];r.querySelectorAll(`[${t}]`).forEach((r=>{let n=r.getAttribute(t),i=e.getAttribute("subtype"),o=types.find((e=>e.name===i)),l=o.isStrict;if(o&&l){let e,t=contraintTypes[o.constraint];if(t===Number){if(e=Number(n),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${i}": ${n} (expected number)`)}else if(t===Boolean)if("true"===n.toLowerCase())e=!0;else{if("false"!==n.toLowerCase())throw new Error(`Invalid attribute value for subtype "${i}": ${n} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${i}": ${o.constraint}`);e=n}}}))}}))}))};class Router{constructor(e){this.routes=e||{},this.currentRoute="",window.addEventListener("hashchange",(()=>{this.route()})),window.addEventListener("DOMContentLoaded",(()=>{this.route()})),this.fallbackRoute="",this.errorOn=!1}route(){const e=window.location.hash.slice(1);this.currentRoute=e,this.navigate()}render(e){templates.forEach((t=>{let r=t.parent,n=t.template,i=t.element,o=r.getAttribute("title");o&&(document.title=o),r.getAttribute("route")==e?(rerender(),i.innerHTML=n,window.currentRender=i):i.innerHTML=""}))}navigate(){let e=!1;this.routes&&Object.keys(this.routes).forEach((async t=>{const{isMatch:r,params:n,query:i,asterisk:o}=this.isRouteMatch(this.currentRoute,t);if(r){if(e=!0,Object.keys(i).length>0&&window.location.hash.includes("?")){t=window.location.hash.split("?")[0].replace("#","");const e=this.routes[t];return this.render(t),await setTimeout((()=>{}),2),e({params:n,query:i}),void(window.dox=window.dox||{})}if(Object.keys(n).length>0&&!window.location.hash.includes("?")){const e=this.routes[t],r=t.split("/:")[0];return this.render(r),await setTimeout((()=>{}),2),e({params:n,query:i}),void(window.dox=window.dox||{})}if(o){const e=this.routes[t],r=t.split("/*")[0];return this.render(r),await setTimeout((()=>{}),2),e({asterisk:o}),void(window.dox=window.dox||{})}{const e=this.routes[t];return this.render(t),await setTimeout((()=>{}),2),e({params:n,query:i}),void(window.dox=window.dox||{})}}})),!e&&this.fallbackRoute&&(window.location.hash="#"+this.fallbackRoute)}isRouteMatch(e,t){const r=e.split("/").filter((e=>""!==e)),n=t.split("/").filter((e=>""!==e));if(r.length!==n.length&&!t.includes("*"))return{isMatch:!1};const i={};let o={},l="";for(let e=0;e<n.length;e++){const t=r[e],a=n[e];if(a.startsWith(":")){const e=t;i[a.slice(1)]=e}else if(a.includes("?")){const e=a.split("?")[1];o=this.extractQuery(e)}else{if(a.includes("*")){l=r.slice(e).join("/");break}if(t!==a)return{isMatch:!1}}}return{isMatch:!0,params:i,query:o,asterisk:l}}get(e,t){this.routes[e]=t}redirect(e){window.location.hash="#"+e}extractParams(e,t){const r=e.split("/").filter((e=>""!==e)),n=t.split("/").filter((e=>""!==e)),i={};for(let e=0;e<n.length;e++){const t=n[e];if(t.startsWith(":")){const n=t.slice(1),o=r[e];i[n]=o}}return i}extractQuery(e){const t=e.indexOf("?");if(-1!==t){const r=e.slice(t+1).split("&"),n={};return r.forEach((e=>{const[t,r]=e.split("=");n[t]=decodeURIComponent(r)})),n}return{}}extractAsterics(e){const t=e.indexOf("*");if(-1!==t){const r=e.slice(t+1).split("&"),n={};return r.forEach((e=>{const[t,r]=e.split("=");n[t]=decodeURIComponent(r)})),n}}}async function setData(data,html,body,item){let exported=item.getAttribute("exports").split(","),importName=item.getAttribute("exports").split(","),dom=new DOMParser,dhtml=await dom.parseFromString(data,"text/html").body,props={},parsedjs=(code,parent)=>{let style;if(code.includes("style")){style=code.split(".");let e=style[1].split("=")[0],t=style[1].split("=")[1];dhtml.querySelector(parent.tagName).style[e]=t,body.querySelector(parent.tagName).style[e]=t}else if(code.includes("{{")){let value=code.split("{{")[1].split("}}")[0];eval(value)}code.includes("parent")};if(dhtml.querySelectorAll("[state]").forEach((e=>{let t=e.getAttribute("state");e.id=t,null!=getState(t)&&null!=getState(t)||setState(t,""),e.innerHTML=e.innerHTML+getState(t),setTimeout((()=>{effect(t,(r=>{setTimeout((()=>{"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.value=r),"SELECT"==e.tagName&&(e.value=r),"IMG"==e.tagName&&(e.src=r),"A"==e.tagName&&(e.href=r),"IFRAME"==e.tagName&&(e.src=r),"VIDEO"==e.tagName&&(e.src=r),"AUDIO"==e.tagName&&(e.src=r),"EMBED"==e.tagName&&(e.src=r),"OBJECT"==e.tagName&&(e.src=r),"SOURCE"==e.tagName&&(e.src=r),"TRACK"==e.tagName?e.src=r:e.innerHTML=r,document.querySelector(`#${t}`).innerHTML=r}),0)}))}),0)})),dhtml.querySelector("if")){let e=dhtml.querySelector("if"),t=e.getAttribute("prop")?e.getAttribute("prop"):null,r=e.getAttribute("is"),n=e.getAttribute("else"),i=e.parentNode,o=e.getAttribute("props")?e.getAttribute("props").split(","):null,l=html.querySelector(i.tagName);t&&o&&o.forEach((n=>{if(l.getAttribute(t)==r){let t=e.innerHTML;if(t.includes("{{")){let e=t.split("{{")[1].split("}}")[0];parsedjs(e,i)}}}))}dhtml.querySelectorAll("var").forEach((e=>{e.style.display="none";let t=e.getAttribute("name"),r=e.innerHTML;dhtml.querySelectorAll("*").forEach((e=>{let n=e.innerHTML.match(/{{(.*?)}}/g);if(n&&e.innerHTML.includes(`{{${t}}}`)){e.id=t;e.innerHTML;n.forEach((t=>{e.innerHTML=e.innerHTML.replace(t,r)}))}})),e.remove()})),dhtml.querySelectorAll("*").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.match(/{{(.*?)}}/g);if(t){let r=t[0].split("{{")[1].split("}}")[0];if(r.includes("json.map")){let t=r.split("json.map(")[1].split(")")[0];if(window[t]&&r.includes("return")){let n=r.split("return(")[1].split(")")[0].replace(/'/g,"");JSON.parse(window[t]).forEach((t=>{let r=document.createElement(n);r.innerHTML=r.innerHTML+t.name,e.innerHTML=r.outerHTML}))}}}}}));let proptemplates=[];dhtml.querySelectorAll("[props]").forEach((async e=>{let t=e.tagName;if(html.querySelector(t)){let r=e.getAttribute("props").split(":");r.forEach((async e=>{if(props[t]=r,sessionStorage.setItem("$dox-props",JSON.stringify(props)),"children"==e)html.querySelector(t).querySelector("slot")&&dhtml.querySelector(t).innerHTML.includes("{{children}}")&&(proptemplates.length>0&&proptemplates.forEach((e=>{e.parent==dhtml.querySelector(t).parentNode&&(dhtml.querySelector(t).innerHTML=e.template)})),proptemplates.push({element:dhtml.querySelector(t),template:dhtml.querySelector(t).innerHTML,parent:dhtml.querySelector(t).parentNode?dhtml.querySelector(t).parentNode:null}),dhtml.querySelector(t).innerHTML=dhtml.querySelector(t).innerHTML.replace("{{children}}",html.querySelector(t).querySelector("slot").innerHTML));else if(html.querySelector(t).getAttribute(e)&&(proptemplates.length>0&&proptemplates.forEach((r=>{dhtml.querySelector(t).innerHTML.includes(`{{${e}}}`)&&(dhtml.querySelector(t).innerHTML=dhtml.querySelector(t).innerHTML.replace(`{{${e}}}`,html.querySelector(t).getAttribute(e)))})),dhtml.querySelector(t).innerHTML.includes(`{{${e}}}`))){proptemplates.push({element:dhtml.querySelector(t),template:dhtml.querySelector(t).innerHTML,parent:dhtml.querySelector(t).parentNode?dhtml.querySelector(t).parentNode:null});let r=html.querySelector(t).getAttribute(e);dhtml.querySelector(t).innerHTML=dhtml.querySelector(t).innerHTML.replace(`{{${e}}}`,r)}}))}})),dhtml.querySelectorAll("*").forEach((e=>{Object.values(e.attributes).forEach((t=>{let r=t.value;if(r.includes("{{")){let n=r.match(/{{(.*?)}}/g);n&&(n.forEach((t=>{let n=t.replace("{{","").replace("}}",""),i=e.parentNode.getAttribute(n),o=document.querySelector(e.parentNode.tagName);o&&o.getAttribute(n)&&(i=o.getAttribute(n)),r=r.replace(new RegExp(`{{${n}}}`,"g"),i)})),e.setAttribute(t.name,r))}}));let t=e.innerHTML.match(/{{(.*?)}}/g);if(t&&t.forEach((t=>{let r=t.split("{{")[1].split("}}")[0],n=dhtml.querySelector(e.tagName).parentNode.tagName;html.querySelectorAll("*").forEach((t=>{if(t.tagName==n){let n=t.getAttribute(r);if(n){"true"==n.toString().toLowerCase()&&(n=n.toString().toLowerCase());let t=e.innerHTML.replace(new RegExp(`{{${r}}}`,"g"),n);e.innerHTML=t}}}))})),e.hasAttribute("state")){let t=e.getAttribute("state");e.innerHTML=e.innerHTML+getState(t),document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=e.innerHTML),effect(t,(t=>{document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=t)}))}})),exported.forEach((async e=>{let t=dhtml.querySelector(e)?dhtml.querySelector(e):html.querySelector(e);var r;(await(r=e,new Promise((e=>{if(document.querySelector(r))return e(document.querySelector(r));const t=new MutationObserver((n=>{document.querySelector(r)&&(e(document.querySelector(r)),t.disconnect())}));t.observe(document.body,{childList:!0,subtree:!0})})))).innerHTML=t.innerHTML}))}imports.map((async e=>{if(!(e.endsWith(".html")||e.endsWith(".css")||e.endsWith(".js")))throw new Error("Unsupported imported file type!");if(e.endsWith(".js")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/javascript",t.setAttribute("as","script"),document.querySelector("head").appendChild(t),cache[e]?cache[e]:await fetch(e).then((e=>e.text())).then((t=>{if(t.includes("document")&&!e.includes("tailwind.js"))throw new Error("Imported JS file cannot contain document. Use dox instead.");if((t.includes("innerHTML")||t.includes("innerText"))&&!e.endsWith("tailwind.js"))throw new Error("Use dox:text to return text and dox:$ to return HTML.");let r=document.createElement("script");r.id="dox-script",r.type="module",r.innerHTML=t,document.head.appendChild(r)}))}if(e.endsWith(".html")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/html",t.setAttribute("as","document"),document.querySelector("head").appendChild(t),cache[e]?parser(cache[e]):await fetch(e).then((e=>e.text())).then((async t=>{cache[e]=t,await parser(t)}))}})),window.Router=Router,window.dox=dox;const states={},setState=(e,t)=>{states[e]=t,window.postMessage({name:e,value:t},"*")},getState=e=>states[e];window.addEventListener("message",(e=>{if(e.origin!==window.location.origin)return;const{name:t,value:r}=e.data;states[t]=r}));const effect=(e,t=(()=>{}))=>{window.addEventListener("message",(r=>{if(r.origin!==window.location.origin)return;const{name:n,value:i}=r.data;n===e&&t(i)}))};window.effect=effect,window.getState=getState,window.setState=setState,window.dox=dox;