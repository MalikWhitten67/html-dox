let e=[],t=document.querySelector("imports");t.style.display="none";let r=[],n=t.innerHTML.replace(/\s/g,"");n=n.split(","),n=n.filter(Boolean);let o={};if(document.querySelector("script")&&!document.querySelector("script").getAttribute("src").includes("html-dox.js"))throw new Error("html-dox.js must be the last script tag in the body");if(document.querySelector("style"))throw new Error("Style tags are not supported in dox!");if(document.querySelector("link"))throw new Error("Link tags are not supported in dox!");document.body.style.display="none";let i=[],l={"dox:string":String,"dox:number":Number,"dox:boolean":Boolean,"dox:array":Array,"dox:object":Object,"dox:undefined":void 0,"dox:null":null,"dox:function":Function,"dox:regexp":RegExp,"dox:date":Date},s=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):{};function a(e,t,n,o){let i=o.getAttribute("exports").split(","),l=(new DOMParser).parseFromString(e,"text/html");l.querySelectorAll("*").forEach((e=>{if(e.hasAttribute("style")){e.getAttribute("style").split(";").forEach(((t,r)=>{console.error(`Error in line ${r+1} conflicting styles embedded in dox are not supported at:\n${e.innerHTML.split("<")[0]}`)}))}})),l.querySelectorAll("*").forEach((e=>{Object.values(e.attributes).forEach((t=>{let r=t.value;if(r.includes("{{")){let n=r.match(/{{(.*?)}}/g);n&&(n.forEach((t=>{let n=t.replace("{{","").replace("}}",""),o=e.parentNode.getAttribute(n),i=document.querySelector(e.parentNode.tagName);i&&i.getAttribute(n)&&(o=i.getAttribute(n)),r=r.replace(new RegExp(`{{${n}}}`,"g"),o)})),e.setAttribute(t.name,r))}}))})),l.querySelectorAll("*").forEach((e=>{let r=e.innerHTML.match(/{{(.*?)}}/g);r&&r.forEach((r=>{let n=r.split("{{")[1].split("}}")[0],o=l.querySelector(e.tagName).parentNode.tagName;t.querySelectorAll("*").forEach((t=>{if(t.tagName==o){let r=t.getAttribute(n);if(r){"true"==r.toString().toLowerCase()&&(r=r.toString().toLowerCase());let t=e.innerHTML.replace(new RegExp(`{{${n}}}`,"g"),r);e.innerHTML=t}}}))}))}));let s={};l.querySelectorAll("[props]").forEach((e=>{let r=e.tagName;if(t.querySelector(r)){let n=e.getAttribute("props").split(":");n.forEach((e=>{s[r]=n,sessionStorage.setItem("$dox-props",JSON.stringify(s)),"children"==e&&t.querySelector(r).querySelector("slot")&&l.querySelector(r).innerHTML.includes("{{children}}")&&(l.querySelector(r).innerHTML=l.querySelector(r).innerHTML.replace("{{children}}",t.querySelector(r).querySelector("slot").innerHTML))}))}})),document.querySelectorAll("img, svg").forEach((e=>{let t=e.getAttribute("src")||e.getAttribute("data-src"),r=document.createElement("link");r.setAttribute("rel","preload"),r.setAttribute("href",t),r.type="image/*",r.setAttribute("as","image"),document.querySelector("head").appendChild(r);const n=new IntersectionObserver((r=>{r.forEach((r=>{r.isIntersecting&&(e.setAttribute("src",t),n.unobserve(e))}))}));n.observe(e)})),l.querySelectorAll("var").forEach((e=>{e.style.display="none";let t=e.getAttribute("name"),n=e.innerHTML;l.querySelectorAll("*").forEach((e=>{e.innerHTML.includes(`{{${t}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t}}}`,n)),r.forEach((t=>{e.innerHTML.includes(`{{${t.name}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t.name}}}`,t.value))}))})),e.remove()})),l.querySelectorAll("*").forEach((e=>{o.getAttribute("exports").split(",").forEach((e=>{let r=e.replace(/\s/g,"");i.forEach((e=>{e==r&&t.querySelector(r)&&(t.querySelector(r).innerHTML=l.querySelector(r).innerHTML,n.querySelector(r)&&l.querySelector(r)&&(n.querySelector(r).innerHTML=l.querySelector(r).innerHTML))}))}))}))}n.map((e=>{if(!e.endsWith(".html")&&!e.endsWith(".css")&&!e.endsWith(".js"))throw new Error("Unsupported imported file type!");if(e.endsWith(".html")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/html",t.setAttribute("as","document"),document.querySelector("head").appendChild(t),o[e]?u(o[e]):fetch(e).then((e=>e.text())).then((t=>{o[e]=t,u(t)}))}else if(e.endsWith(".css")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/css",t.setAttribute("as","style"),document.querySelector("head").appendChild(t);let r=document.createElement("style");if(o[e]){let t=document.createElement("style");t.innerHTML=o[e],document.querySelector("head").appendChild(t)}else fetch(e).then((e=>e.text())).then((t=>{o[e]=t,r.innerHTML=t,document.querySelector("head").appendChild(r)}))}else if(e.endsWith(".js")){let t=document.createElement("link");if(t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/javascript",t.setAttribute("as","script"),document.querySelector("head").appendChild(t),o[e]){new Function(o[e])()}else fetch(e).then((e=>e.text())).then((t=>{if(t.includes("import "))throw new Error('Import statements with the "from" keyword are not allowed. Use $import instead.');if(t.includes("export "))throw new Error("Export statements are not allowed. Use $export instead.");if(t.includes("document")&&!e.includes("tailwind.js"))throw new Error("Imported JS file cannot contain document. Use dox instead.");if((t.includes("innerHTML")||t.includes("innerText"))&&!e.endsWith("tailwind.js"))throw new Error("Use dox:text to return text and dox:$ to return HTML.");new Function(t)()}))}}));const u=t=>{let r=(new DOMParser).parseFromString(t,"text/html");r=r.querySelector("html");let u,c=document.querySelector("body"),d=performance.now(),p=r.querySelector("export");p&&(p=p.innerHTML.replace(/\s/g,""),p=p.split(","),p=p.filter(Boolean),p.forEach((t=>{let p=r.querySelector(t);if([].forEach((e=>{if(p.hasAttribute(e)&&"typeof"===e){let r=i.find((t=>t.name===p.getAttribute(e)));if(!r)throw new Error(`Type "${p.getAttribute(e)}" does not exist`);{let e,n=l[r.constraint],o=c.querySelector(t).innerHTML;if("false"===r.isStrict)return;if(n===Number){if(e=Number(o),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid value for type "${r.name}": ${o} (expected number)`)}else if(n===Boolean)if("true"===o.toLowerCase())e=!0;else{if("false"!==o.toLowerCase())throw new Error(`Invalid value for type "${r.name}": ${o} (expected boolean)`);e=!1}else{if(n!==String)throw new Error(`Invalid constraint type for type "${r.name}": ${r.constraint}`);e=o}}}})),r.querySelector(t).hasAttribute("props")){let e=r.querySelector(t).getAttribute("props").split(":");e.forEach((r=>{s[t]=e,sessionStorage.setItem("$dox-props",JSON.stringify(s)),p.querySelectorAll("[derive]").forEach((e=>{let r=e.getAttribute("derive"),n=c.querySelector(t).getAttribute(r);e.innerHTML.includes(`{{${r}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${r}}}`,n))})),p.innerHTML.split("{{").forEach((e=>{let r=e.split("}}")[0];p.innerHTML.includes(`{{${r}}}`)&&(p.innerHTML=p.innerHTML.replace(`{{${r}}}`,c.querySelector(t).getAttribute(r)))})),p.innerHTML.includes(`{{${r}}}`)&&(p.innerHTML=p.innerHTML.replace(`{{${r}}}`,c.querySelector(t).getAttribute(r)))}))}e.push({name:p.tagName,template:p.innerHTML});let h=c.querySelector(t);function f(e){if(h){document.querySelector(h.tagName).innerHTML=h.innerHTML,r.querySelectorAll("import").forEach((e=>{let t=e.getAttribute("src");if(!t.endsWith(".html"))throw new Error("Unsupported imported file type!");window[t]?a(window[t],r,c,e):fetch(t).then((e=>e.text())).then((n=>{window[t]=n,a(n,r,c,e)}))}))}}h.innerHTML=p.innerHTML;let m=document.querySelector("meta[config]"),y=m.getAttribute("fallback"),w={};function b(e){if(u=performance.now()-d,w[window.location.hash]||(window.location.hash=y),h&&!e){f();let e=h?h.parentNode:null,o=r.querySelector(t);if(w[window.location.hash]=o.innerHTML,e&&e.hasAttribute("route")||e.hasAttribute("overide")){let t=e.getAttribute("route"),r=e.getAttribute("position");t&&"first"===r?n(h,o,"first",e.getAttribute("route")):t&&"last"===r&&n(h,o,"last",e.getAttribute("route"))}else{let e=document.createElement("div");e.style="position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:9999; font-family: sans-serif; font-size: 30px;",e.innerHTML='<h1 style="text-align:center;margin-top:50vh">Route is blocked!</h1>',h.innerHTML=e.outerHTML}}else{let o=document.querySelector(e),i=o?o.parentNode:null,l=r.querySelector(t);if(w[window.location.hash]=l.innerHTML,i&&i.hasAttribute("route")||i.hasAttribute("overide")){let e=i.getAttribute("route"),t=i.getAttribute("position");o.innerHTML="",e&&"first"===t?n(o,l,"first",i.getAttribute("route")):e&&"last"===t&&n(o,l,"last",i.getAttribute("route"))}else{let e=document.createElement("div");e.style="position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:9999; font-family: sans-serif; font-size: 30px;",e.innerHTML='<h1 style="text-align:center;margin-top:50vh">Route is blocked!</h1>',h.innerHTML=e.outerHTML}}function n(e,t,r,n){let o;w[n]=t.innerHTML,o=!(n="#"+n),e.querySelectorAll("*").forEach((e=>{e.hasAttribute("route")&&(e.innerHTML="")})),n!==window.location.hash||o?h.innerHTML="":h.innerHTML=t.innerHTML}}m&&(m=m.getAttribute("routes"),m=m.split(","),m.forEach((e=>{w[`#${e}`]=`#${e}`}))),y="#"+y,w[window.location.hash]||(window.location.hash=y),b(),window.addEventListener("hashchange",(()=>{document.querySelector("html").setAttribute("root",window.location.hash.split("#")[1]),b(),n.map((e=>{e.endsWith(".js")&&(o[e]?new Function(o[e])():fetch(e).then((e=>e.text())).then((t=>{if(t.includes("import "))throw new Error('Import statements with the "from" keyword are not allowed. Use $import instead.');if(t.includes("export "))throw new Error("Export statements are not allowed. Use $export instead.");if(t.includes("document")&&!e.includes("tailwind.js"))throw new Error("Imported JS file cannot contain document. Use dox instead.");if((t.includes("innerHTML")||t.includes("innerText"))&&!e.endsWith("tailwind.js"))throw new Error("Use dox:text to return text and dox:$ to return HTML.");new Function(t)()})))})),f()}))}))),window.$import=e=>{if(!e.endsWith(".js"))return window[e];fetch(file).then((e=>e.text())).then((e=>{if(e.includes("import "))throw new Error('Import statements with the "from" keyword are not allowed. Use $import instead.');if(e.includes("export "))throw new Error("Export statements are not allowed. Use $export instead.");if(e.includes("document")&&!item.includes("tailwind.js"))throw new Error("Imported js file cannot contain document use dox instead");if(e.includes("innerHTML")||e.includes("innerText")&&!item.endsWith("tailwind.js"))throw new Error("use dox:text  to return text and dox:$ to return html");new Function(e)()}))},window.$export=(e,t)=>{window[e]=t},c.querySelectorAll("type").forEach((e=>{let t=e.querySelectorAll("subtype");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!l[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),t.forEach((e=>{if(!l[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),r.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];c.querySelectorAll(`[${t}]`).forEach((r=>{let n=r.getAttribute(t),o=e.getAttribute("subtype"),s=i.find((e=>e.name===o)),a=s.isStrict;if(s&&a){let e,t=l[s.constraint];if(t===Number){if(e=Number(n),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${o}": ${n} (expected number)`)}else if(t===Boolean)if("true"===n.toLowerCase())e=!0;else{if("false"!==n.toLowerCase())throw new Error(`Invalid attribute value for subtype "${o}": ${n} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${o}": ${s.constraint}`);e=n}}}))}}))})),r.querySelectorAll("type").forEach((e=>{let t=e.querySelectorAll("subtype"),n=[];t.forEach((t=>{if(n.push(t.getAttribute("name")),n.filter(((e,t)=>n.indexOf(e)!==t)).length>0)throw new Error("Two subtypes cannot have the same name");if(t.getAttribute("name")===e.getAttribute("name"))throw new Error("Types and subtypes cannot have the same name")})),i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!l[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")})})),r.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];c.querySelectorAll(`[${t}]`).forEach((r=>{let n=r.getAttribute(t),o=e.getAttribute("subtype"),s=i.find((e=>e.name===o)),a=s.isStrict;if(s&&a){let e,t=l[s.constraint];if(t===Number){if(e=Number(n),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${o}": ${n} (expected number)`)}else if(t===Boolean)if("true"===n.toLowerCase())e=!0;else{if("false"!==n.toLowerCase())throw new Error(`Invalid attribute value for subtype "${o}": ${n} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${o}": ${s.constraint}`);e=n}}}))}}))}))};document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{document.body.style.display="block"}),150)}));let c={currentRoute:()=>window.location.hash.split("#")[1],rendered:(e=(()=>{}))=>{document.querySelectorAll("*").forEach((t=>{"RENDER"==t.parentNode.tagName&&t.innerHTML.length>0&&e({name:t.tagName,props:JSON.parse(sessionStorage.getItem("$dox-props"))[t.tagName],html:t.innerHTML,rendered:finished+"ms"})}))},querySelector:e=>{let t=document.querySelector(e)||html.querySelector(e);if(t){let e={getDescendants:()=>{let e=[],r=t=>{let n=t.children;for(let t=0;t<n.length;t++)e.push(n[t]),r(n[t])};return r(t),{forEach:r=>{e.forEach((n=>{r({id:n.id,class:n.className,text:n.innerText,setHtml:e=>{n.innerHTML=e},getItem:e=>n.querySelector(`#${e}`),getHtml:()=>n.innerHTML,getChildren:()=>{let e=[];return n.querySelectorAll("*").forEach((r=>{r.parentNode===t&&e.push(r)})),e},getAncestors:()=>{let e=[],t=n.parentNode;for(;t;)e.push(t),t=t.parentNode;return e},props:()=>s[n.tagName],querySelector:t=>(e=e.filter((e=>e.matches(t))),e),fadeIn:e=>{n.style.opacity=0,n.style.transition=`opacity ${e}s`,n.style.opacity=1},fadeOut:e=>{n.style.opacity=1,n.style.transition=`opacity ${e}s`,n.style.opacity=0},on:(e,t)=>{n.addEventListener(e,t)},inject:e=>{n.innerHTML=e},state:e=>{let t=states.find((t=>t.name===e));if(t)return t.value;throw new Error(`State "${e}" does not exist`)},setState:(e,t)=>{let r=states.find((t=>t.name===e));r?r.value=t:states.push({name:e,value:t})},watch:(e,t)=>{let r=states.find((t=>t.name===e));if(!r)throw new Error(`State "${e}" does not exist`);t(r.value)}})}))},map:t=>{let r=[];return e.forEach((e=>{r.push(t(e))})),r},querySelector:e=>{c.querySelector(e)},querySelectorAll:t=>(e=e.filter((e=>e.matches(t))),e),inject:(e,t)=>{let r=document.querySelector(e);r&&(r.innerHTML=t)},html:()=>{let t="";return e.forEach((e=>{t+=e.outerHTML})),t},getAncestors:()=>{let e=[],r=t.parentNode;for(;r;)e.push(r),r=r.parentNode;return e}}},attr:(e,r)=>{if(!r)return t.getAttribute(e);t.setAttribute(e,r)},replaceType:e=>{let r=document.createElement(e);r.innerHTML=t.innerHTML,Object.values(t.attributes).forEach((e=>{r.setAttribute(e.name,e.value)})),t.classList.forEach((e=>{r.classList.add(e)})),t.parentNode.replaceChild(r,t)},props:JSON.parse(sessionStorage.getItem("$dox-props"))[t.tagName],inject:(e,t)=>{let r=document.querySelector(e);r&&(r.innerHTML=t)},getAncestors:()=>{let e=[],r=t.parentNode;for(;r;)e.push(r),r=r.parentNode;return e},text:t.innerText,html:t.innerHTML,getChildren:()=>{let e=[];return t.querySelectorAll("*").forEach((r=>{r.parentNode===t&&e.push(r)})),e}};return e}return null},querySelectorAll:e=>{let t=document.querySelectorAll(e)||html.querySelectorAll(e);if(t){let e={forEach:e=>{t.forEach((r=>{e({id:r.id,class:r.className,text:r.innerText,html:r.innerHTML,getChildren:()=>{let e=[];return r.querySelectorAll("*").forEach((t=>{t.parentNode===el&&e.push(t)})),e},getAncestors:()=>{let e=[],t=r.parentNode;for(;t;)e.push(t),t=t.parentNode;return e},querySelector:e=>(t=t.filter((t=>t.matches(e))),t),fadeIn:e=>{r.style.opacity=0,r.style.transition=`opacity ${e}s`,r.style.opacity=1},fadeOut:e=>{r.style.opacity=1,r.style.transition=`opacity ${e}s`,r.style.opacity=0},on:(e,t)=>{r.addEventListener(e,t)},inject:e=>{r.innerHTML=e},state:e=>{let t=states.find((t=>t.name===e));if(t)return t.value;throw new Error(`State "${e}" does not exist`)},setState:(e,t)=>{let r=states.find((t=>t.name===e));r?r.value=t:states.push({name:e,value:t})},watch:(e,t)=>{let r=states.find((t=>t.name===e));if(!r)throw new Error(`State "${e}" does not exist`);t(r.value)}})}))},map:e=>{let r=[];return t.forEach((t=>{r.push(e(t))})),r},querySelector:e=>{c.querySelector(e)},querySelectorAll:e=>(t=t.filter((t=>t.matches(e))),t),inject:(e,t)=>{let r=document.querySelector(e);r&&(r.innerHTML=t)},getAncestors:()=>{let e=[],t=el.parentNode;for(;t;)e.push(t),t=t.parentNode;return e},text:el.innerText,html:el.innerHTML,getChildren:()=>{let e=[];return el.querySelectorAll("*").forEach((t=>{t.parentNode===el&&e.push(t)})),e}};return e}return null}};window.dox=c;