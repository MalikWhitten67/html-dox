let dox,currentRender,templates=[],importsTag=document.querySelector("imports"),importmeta=document.querySelector("[imports]"),imports;if(importmeta)imports=importmeta.getAttribute("imports").replace(/\s/g,"");else if(importsTag)throw new Error('<imports> is deprecated use <meta imports="/someimport,/someimport"> instead! read latest git release for more info: https://github.com/MalikWhitten67/html-dox/releases/latest');if(!(imports.length>0))throw new Error('No imports found! Please add <meta imports="/someimport,/someimport"> to your html file');imports=imports.split(","),imports=imports.filter(Boolean);let cache={},types=[],contraintTypes={"dox:string":String,"dox:number":Number,"dox:boolean":Boolean,"dox:array":Array,"dox:object":Object,"dox:undefined":void 0,"dox:null":null,"dox:function":Function,"dox:regexp":RegExp,"dox:date":Date},variables=[],props=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):{};const parser=async e=>{let t=(new DOMParser).parseFromString(e,"text/html");t=t.body;let r=document.body;t.querySelectorAll("import").forEach((e=>{let n=e.getAttribute("src");if(!n.endsWith(".html"))throw new Error("Unsupported imported file type!");window[n]?setData(window[n],t,r,e):fetch(n).then((e=>e.text())).then((o=>{window[n]=o,setData(o,t,r,e)}))}));let n=t.querySelector("export");n&&(n.style.display="none"),t.querySelectorAll("var").forEach((e=>{e.style.display="none";let r=e.getAttribute("name"),n=e.innerHTML.replace(/\s/g,"");if(window[r]=n,e.html,window[r+"Element"]=e,e.hasAttribute("state")){let t=e.getAttribute("state");null!=getState(t)&&null!=getState(t)||setState(t,""),effect(t,(t=>{setTimeout((()=>{e.innerHTML=t}),0)}))}t.querySelectorAll("*").forEach((t=>{let o=t.innerHTML.match(/{{(.*?)}}/g),i=t.outerHTML.match(/{{(.*?)}}/g);t.innerHTML;i?i.forEach((e=>{e.split("{{")[1].split("}}")[0]==r&&t.parentNode&&(t.outerHTML=t.outerHTML.replace(e,n))})):o&&t.innerHTML.includes(`{{${r}}}`)?o.forEach((r=>{window.onmessage=t=>{if(t.origin==window.location.origin&&"setVar"==t.data.type){let r=t.data.name,n=t.data.value;e.getAttribute("name")==r&&(window[r]=n,e.innerHTML=n)}},t.innerHTML=t.innerHTML.replace(r,JSON.parse(e.innerHTML))})):window.onmessage=t=>{if(t.origin==window.location.origin&&"setVar"==t.data.type){let r=t.data.name,n=t.data.value;e.getAttribute("name")==r&&(window[r]=n,e.innerHTML=n)}}})),e.remove()})),n&&(n=n.innerHTML.replace(/\s/g,""),n=n.split(","),n=n.filter(Boolean),n.forEach((async e=>{function n(e){e.inject=t=>(e.innerHTML=t,n(e));let r=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):[];return r=r[e.tagName],r&&(e.props=r),e.class=t=>(e.className=t,n(e)),e.add=(t,r)=>{let o=document.createElement(t);return r&&Object.keys(r).forEach((e=>{o.setAttribute(e,r[e])})),e.appendChild(o),n(o)},e.delete=()=>(e.remove(),n(e)),e.parent=()=>n(e.parentNode),e.query=e=>{let t=document.querySelector(e);if(t)return n(t)},e.classes=(t,r)=>("add"==r&&e.classList.add(t),"remove"==r&&e.classList.remove(t),"toggle"==r&&e.classList.toggle(t),n(e)),e.html=t=>t?(e.innerHTML=t,n(e)):e.innerHTML,e.prepend=t=>(e.innerHTML=t+e.innerHTML,n(e)),e.append=t=>(e.innerHTML+=t,n(e)),e.blur=()=>{e.blur()},e.fade=t=>{e.style.transition=`opacity ${t}s`,e.style.opacity=0},e.focus=e.focus,e.queryAll=t=>{let r=e.querySelectorAll(t);return e.forEach=e=>{r.forEach((t=>{e(t)}))},r.forEach((e=>{e=n(e)})),r},e.after=t=>(e.insertAdjacentHTML("afterend",t),n(e)),e.before=t=>(e.insertAdjacentHTML("beforebegin",t),n(e)),e.attr=(t,r)=>r?(e.setAttribute(t,r),n(e)):e.getAttribute(t),e.replace=(t,r)=>{let o=document.createElement(t);return o.innerHTML=r,e.parentNode.replaceChild(o,e),n(o)},e.on=(t,r)=>{e.addEventListener(t,(t=>(Object.defineProperty(t,"target",{value:n(t.target)}),Object.defineProperty(t,"currentTarget",{value:n(t.currentTarget)}),r(t),n(e))))},e.setProp=(r,o)=>{if(o)return t.querySelector(e.tagName).setAttribute(r,o),i(),n(e)},e.css=(t,r)=>r?(e.style[t]=r,n(e)):e.style[t],e.getChildren=()=>{let t=[],r=e=>{let o=e.children;for(let i=0;i<o.length;i++)o[i]=n(o[i]),o[i].parent=e,o[i].index=i,t.push(o[i]),r(o[i])};return e.forEach=r=>(t.forEach((e=>{r(e)})),n(e)),e.map=(r,o)=>(o?t.forEach((e=>{r(e,o)})):t.forEach((e=>{r(e)})),n(e)),r(e),t},e}dox={route:()=>window.currentRoute,currentRender:()=>currentRender,setProp:(e,r,o)=>{let l=t.querySelector(e);return l&&(l.setAttribute(r,o),i()),n(l)},setVar:(e,t)=>{window[e]=t,window.postMessage({type:"setVar",name:e,value:t},window.location.origin)},current:()=>{let e=document.activeElement;if(e)return e.isActive=!0,n(e)},domChange:(e,t=!1,r=(()=>{}))=>{var n=!1;new MutationObserver((function(t){n&&"changed"===e?t.forEach((function(e){r(e)})):r()})).observe(document,{childList:!0,subtree:!0}),setTimeout((()=>{n=!0,t&&r()}),100)},add:(e,t)=>{let r=document.createElement(e);return Object.keys(t).forEach((e=>{r.setAttribute(e,t[e])})),r=n(r),n(r)},title:e=>{document.title=e},querySelector:e=>{let t=document.querySelector(e);return t&&(t=n(t)),t},querySelectorAll:e=>{let o=currentRender.querySelectorAll(e)||t.querySelectorAll(e)||r.querySelectorAll(e)||null,i=[];return o.forEach((e=>{i.push(n(e))})),i},html:document.querySelector("html").innerHTML,text:document.querySelector("html").innerText,on:(e,t)=>{window.addEventListener(e,t)},post:(e,t,r,n)=>{"object"==typeof t?(t=JSON.stringify(t),fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text()))):"string"==typeof t?fetch(e,{method:"POST",headers:{"Content-Type":"text/plain",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text())).then((e=>{r(e)})):JSON.parse(t)&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},get:(e,t,r)=>{fetch(e,{method:"GET",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))},put:(e,t,r,n)=>{fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},delete:(e,t,r)=>{fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))},setMeta:(e=null,t=null,r,n=!1,o=!1)=>{if(t){if(o&&(r.includes("https")||r.includes("http")))return void(r+="?a=b");if(document.querySelector(`meta[property="${t}"]`))return document.querySelector(`meta[property="${t}"]`).setAttribute("content",r),void(n&&document.querySelector(`meta[property="${t}"]`).setAttribute(n,r));{let i=document.createElement("meta");if(o&&(r.includes("https")||r.includes("http")))return void(r+="?a=b");n&&Object.keys(n).forEach((e=>{cosole.log(e),i.setAttribute(e,n[e])})),i.setAttribute("property",t),i.setAttribute("content",r),e&&i.setAttribute("name",e),document.querySelector("head").appendChild(i)}}else if(e){let t=document.createElement("meta");t.setAttribute("name",e),t.setAttribute("content",r),n&&Object.keys(n).forEach((e=>{t.setAttribute(e,n[e])})),document.querySelector("head").appendChild(t)}}},window.dox=dox;let o=t.querySelector(e);[].forEach((t=>{if(o.hasAttribute(t)&&"typeof"===t){let n=types.find((e=>e.name===o.getAttribute(t)));if(!n)throw new Error(`Type "${o.getAttribute(t)}" does not exist`);{let t,o=contraintTypes[n.constraint],i=r.querySelector(e).innerHTML;if("false"===n.isStrict)return;if(o===Number){if(t=Number(i),t=isNaN(t)?0:t,0===t)throw new Error(`Invalid value for type "${n.name}": ${i} (expected number)`)}else if(o===Boolean)if("true"===i.toLowerCase())t=!0;else{if("false"!==i.toLowerCase())throw new Error(`Invalid value for type "${n.name}": ${i} (expected boolean)`);t=!1}else{if(o!==String)throw new Error(`Invalid constraint type for type "${n.name}": ${n.constraint}`);t=i}}}}));if(t.querySelectorAll("[state]").forEach((e=>{let t=e.getAttribute("state");e.id=t,null!=getState(t)&&null!=getState(t)||setState(t,""),e.innerHTML=e.innerHTML+getState(t),setTimeout((()=>{effect(t,(r=>{setTimeout((()=>{"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.value=r),"SELECT"==e.tagName&&(e.value=r),"IMG"==e.tagName&&(e.src=r),"A"==e.tagName&&(e.href=r),"IFRAME"==e.tagName&&(e.src=r),"VIDEO"==e.tagName&&(e.src=r),"AUDIO"==e.tagName&&(e.src=r),"EMBED"==e.tagName&&(e.src=r),"OBJECT"==e.tagName&&(e.src=r),"SOURCE"==e.tagName&&(e.src=r),"TRACK"==e.tagName?e.src=r:e.innerHTML=r,document.querySelector(`#${t}`).innerHTML=r}),0)}))}),0)})),t.querySelectorAll("*").forEach((async e=>{if(e.innerHTML.includes("{{")){let r=e.innerHTML.match(/{{(.*?)}}/g);e.innerHTML;if(r){let o=r[0].split("{{")[1].split("}}")[0];if(o.includes("json.map(")){let i=o.split("json.map(")[1].split(")")[0],l=o.split("json.map(")[1].split(")")[0].split(".")[1];if(i=o.split("json.map(")[1].split(")")[0].split(".")[0],(window[i]||window[i+"Element"])&&o.includes("return")){function t(t){e=t;let n,a=document.createElement("div"),s=o.split("return(")[1].split(")")[0].replace(/'/g,"");try{n=JSON.parse(window[i])}catch(e){console.log(e)}n.forEach((e=>{let t;if(s.includes("[")){let e=s.split("[")[0],r=s.split("[")[1].split("]")[0],n=r.split("=")[1].replace(/'/g,"").replace(/"/g,""),o=r.split("=")[0];t=document.createElement(e),t.setAttribute(o,n)}else if(s.includes(".")){t=document.createElement(s.split(".")[0]);let e=s.split("."),r=e.find((e=>e.includes("style")));if(r)r=r.split("(")[1].split(")")[0].split(";"),r.forEach((e=>{if(e.trim()){let[r,n]=e.split(":");r=r.trim(),n=n.trim(),t.style[r]=n}}));else{let r=e.find((e=>e.includes("class")));r&&(r=r.split("(")[1].split(")")[0],t.className=r)}}else if(s.includes("#")){let e=s.split("#")[1];t=document.createElement(s.split("#")[0]),t.setAttribute("id",e)}else t=document.createElement(s);t.innerHTML="",t.innerHTML=t.innerHTML+e[l],a.append(t)})),e.id=i,e.setAttribute("id",r[0]),document.querySelector(e.tagName)?(document.querySelector(e.tagName).innerHTML="",document.querySelector(e.tagName).append(a),e.innerHTML=e.innerHTML.replace(r[0],a.innerHTML)):e.innerHTML=e.innerHTML.replace(r[0],a.innerHTML)}window[i+"Element"].innerHTML.length>0?t(e):window.onmessage=r=>{if(r.origin==window.location.origin&&"setVar"==r.data.type){let n=r.data.name,o=r.data.value;i==n&&(window[i]=JSON.stringify(o),t(e))}}}}}let n=e.innerHTML.match(/{{(.*?)}}/gs);n&&n.forEach((e=>{let t=e.split("{{")[1].split("}}")[0];if(t.includes("map")&&!t.includes("json.map")){e=e.replace("&gt;",">");let n=new DOMParser,o=t.split("map(")[1].split(")")[0],i=t.split("return(")[1].split(")")[0];i=i.replace("&gt;",">").replace("&gt;",">");let l=e.split("){")[1].trim().split("}}")[0].trim(),a=n.parseFromString(l,"text/html"),s=(l.split(" ")[0].split("<")[1],document.createElement("div"));async function r(e){let t,r;if(e&&e.data&&(t=e.data.name,r=e.data.value),o==t||window[o]){e&&e.data&&(window[o]=JSON.stringify(r)),s.innerHTML="";let t,l,c=JSON.parse(window[o]);i.length>0?(t=new Function("json",`return ${o}.${i})`),l=t(c)):l=c,l.forEach((e=>{let t,r=a.body.innerHTML;Object.entries(e).forEach((([e,t])=>{r=r.replace(new RegExp(`{${o}.${e}}`,"g"),t)})),t=r,s.innerHTML=s.innerHTML+t}));let u=await(n=`[map="${o}"]`,new Promise((e=>{if(document.querySelector(n))return e(document.querySelector(n));const t=new MutationObserver((r=>{document.querySelector(n)&&(e(document.querySelector(n)),t.disconnect())}));t.observe(document.body,{childList:!0,subtree:!0})})));if(u){let e=document.createElement("div");e.innerHTML=s.innerHTML,e.setAttribute("container-map",o),u.querySelector(`[container-map="${o}"]`)?u.querySelector(`[container-map="${o}"]`).innerHTML=s.innerHTML:u.innerHTML=u.innerHTML+e.innerHTML}document.body.innerHTML=document.body.innerHTML.replace(/{{(.*?)}}/gs,""),document.body.innerHTML.includes("}")&&(document.body.innerHTML=document.body.innerHTML.replace(/}/g,""))}var n}window[o]&&r(),window.addEventListener("message",(e=>{e.origin==window.location.origin&&"setVar"==e.data.type&&r(e)}))}}))}})),window.rerender=i,t.querySelector(e).hasAttribute("props")){t.querySelector(e);let n=t.querySelector(e).getAttribute("props").split(":");n.forEach((i=>{if(props[e]=n,sessionStorage.setItem("$dox-props",JSON.stringify(props)),o.querySelectorAll("[derive]").forEach((t=>{let n=t.getAttribute("derive"),o=r.querySelector(e).getAttribute(n);t.innerHTML.includes(`{{${n}}}`)&&(t.innerHTML=t.innerHTML.replace(`{{${n}}}`,o))})),"children"==i){if(t.querySelector(e).querySelector("slot")&&t.querySelector(e).innerHTML.includes("{{children}}")){let r=t.querySelector(e).querySelector("slot").innerHTML;t.querySelector(e).innerHTML=t.querySelector(e).innerHTML.replace("{{children}}",r)}}else r.querySelector(e).getAttribute(i)&&(t.querySelector(e).innerHTML=t.querySelector(e).innerHTML.replace(`{{${i}}}`,r.querySelector(e).getAttribute(i)))}))}function i(r){if(t.querySelector(e)){t.querySelectorAll("import").forEach((async e=>{let r=e.getAttribute("src");if(!r.endsWith(".html"))throw new Error("Unsupported imported file type!");window[r]?(await setTimeout((()=>{}),0),setData(window[r],t,document.body,e)):fetch(r).then((e=>e.text())).then((async n=>{await setTimeout((()=>{}),0),window[r]=n,setData(n,t,document.body,e)}))}))}}document.querySelector(e)&&templates.push({element:document.querySelector(e),parent:document.querySelector(e).parentNode,template:o.innerHTML,html:t,body:r}),i()}))),t.querySelectorAll("type").forEach((e=>{if("types"==!e.parentNode.tagName)throw new Error("Type must be inside of types tag");e.querySelectorAll("subtype");let r=[];types.push({var:e.getAttribute("var")?e.getAttribute("var"):null,prop:e.getAttribute("prop")?e.getAttribute("prop"):null,type:e.getAttribute("type")?e.getAttribute("type"):null,default:e.getAttribute("default")?e.getAttribute("default"):null}),function e(){types.forEach((n=>{if(n.var)if(r.includes(n.var)){let e=window[n.var];if(!e)throw new Error(`Variable "${n.var}" is not defined`);let t=e.trim();if("array"===n.type.toLowerCase()){if(!Array.isArray(e))throw new Error(`Variable "${n.var}" is not an array`)}else if("url"===n.type.toLowerCase()&&!t.includes("http")&&!t.includes("https"))throw new Error(`Variable "${n.var}" is not a url`);if("string"===n.type.toLowerCase()){if(!isNaN(parseFloat(t)))throw new Error(`Variable "${n.var}" is a number, not a string`);if("true"===t.toLowerCase()||"false"===t.toLowerCase())throw new Error(`Variable "${n.var}" is a boolean, not a string`)}else if("number"===n.type.toLowerCase()){if(isNaN(parseFloat(t)))throw new Error(`Variable "${n.var}" is a string, not a number`)}else{if("boolean"!==n.type.toLowerCase())throw new Error(`Unsupported type: ${n.type}`);if("true"!==t.toLowerCase()&&"false"!==t.toLowerCase())throw new Error(`Variable "${n.var}" is a string, not a boolean`)}}else r.push(n.var),window[n.var]=n.default,e();else{if(!n.prop)throw new Error("Type must have var or prop attribute");if(!t.querySelector(`[${n.prop}]`)&&!document.querySelector(`[${n.prop}]`))throw new Error(`Prop "${n.prop}" is not defined or is defined more than once`);{let e=t.querySelector(`[${n.prop}]`)?.getAttribute(n.prop)||document.querySelector(`[${n.prop}]`)?.getAttribute(n.prop);if("string"===n.type.toLowerCase()){if(!isNaN(parseFloat(e))&&!isFinite(e))throw new Error(`Prop "${n.prop}" is a number, not a string`);if("true"===e.toLowerCase()||"false"===e.toLowerCase())throw new Error(`Prop "${n.prop}" is a boolean, not a string`);if(!isNaN(parseFloat(e))&&isFinite(e))throw new Error(`Prop "${n.prop}" is a number, not a string`)}else if("boolean"===n.type.toLowerCase()){if(!isNaN(parseFloat(e)))throw new Error(`Prop "${n.prop}" is a number, not a boolean`);if("true"!==e.toLowerCase()&&"false"!==e.toLowerCase())throw new Error(`Prop "${n.prop}" is a string, not a boolean`)}}}}))}()}))};class Router{constructor(e){this.routes=e||{},this.currentRoute="",window.addEventListener("hashchange",(()=>{this.route()})),window.addEventListener("DOMContentLoaded",(()=>{this.route()})),this.fallbackRoute="",this.errorOn=!1}route(){const e=window.location.hash.slice(1);this.currentRoute=e,this.navigate()}render(e){templates.forEach((t=>{let r=t.parent,n=t.template,o=t.element,i=r.getAttribute("title");i&&(document.title=i),r.getAttribute("route")==e?(rerender(),o.innerHTML=n,window.currentRender=o):o.innerHTML=""}))}navigate(){let e=!1;this.routes&&Object.keys(this.routes).forEach((async t=>{const{isMatch:r,params:n,query:o,asterisk:i}=this.isRouteMatch(this.currentRoute,t);if(r){e=!0;let r=t,l={...o};if(Object.keys(o).length>0&&window.location.hash.includes("?")&&n)r=t.split("?")[0],t=t.split(":")[0],this.render(t);else if(Object.keys(o).length>0&&window.location.hash.includes("?")&&i)r=t.split("?")[0],t=t.split("/*")[0],this.render(t);else if(Object.keys(n).length>0&&!window.location.hash.includes("?"))t=t.split(":")[0],this.render(t);else if(Object.keys(n).length>0&&window.location.hash.includes("?")){const e=t.split(":")[0];this.render(e)}else if(Object.keys(o).length>0&&i){const e=t.split("?")[0];this.render(e)}else if(i){const e=t.split("/*")[0]?t.split("/*")[0]:t.split("*")[0];this.render(e)}else this.render(t);return setTimeout((async()=>{const e=this.routes[r];e&&await e({params:n,query:l,asterisk:i})}),2),void(window.dox=window.dox||{})}})),!e&&this.fallbackRoute&&(window.location.hash="#"+this.fallbackRoute)}isRouteMatch(e,t){const r=e.split("/").filter((e=>""!==e)),n=t.split("/").filter((e=>""!==e));if(r.length!==n.length&&!t.includes("*"))return{isMatch:!1};const o={};let i={},l="";for(let e=0;e<n.length;e++){const t=r[e],a=n[e];if(a.startsWith(":")&&!window.location.hash.includes("?")){const e=t;o[a.slice(1)]=e}else if(a.startsWith(":")&&window.location.hash.includes("?")){const e=a.split(":")[1].split("?")[0],r=t.split("?")[0];o[e]=r;let n=window.location.hash.split("?")[1];i=this.extractQuery(n)}else{if(a.startsWith("*")&&window.location.hash.includes("?")){l=r.slice(e).join("/"),l=l.split("?")[0];break}if(a.startsWith("*")&&!window.location.hash.includes("?")){l=r.slice(e).join("/");break}}}return{isMatch:!0,params:o,query:i,asterisk:l}}get(e,t){this.routes[e]=t}redirect(e){window.location.hash="#"+e}extractParams(e,t){const r=e.split("/").filter((e=>""!==e)),n=t.split("/").filter((e=>""!==e)),o={};for(let e=0;e<n.length;e++){const t=n[e];if(t.startsWith(":")){const n=t.slice(1),i=r[e];o[n]=i}}return o}extractQuery(e){const t=e.split("&"),r={};return t.forEach((e=>{const[t,n]=e.split("=");r[t]=decodeURIComponent(n)})),r}}async function setData(data,html,body,item){let exported=item.getAttribute("exports").split(","),importName=item.getAttribute("exports").split(","),dom=new DOMParser,dhtml=await dom.parseFromString(data,"text/html").body,props={},parsedjs=(code,parent)=>{let style;if(code.includes("style")){style=code.split(".");let e=style[1].split("=")[0],t=style[1].split("=")[1];dhtml.querySelector(parent.tagName).style[e]=t,body.querySelector(parent.tagName).style[e]=t}else if(code.includes("{{")){let value=code.split("{{")[1].split("}}")[0];eval(value)}code.includes("parent")};if(dhtml.querySelectorAll("[state]").forEach((e=>{let t=e.getAttribute("state");e.id=t,null!=getState(t)&&null!=getState(t)||setState(t,""),e.innerHTML=e.innerHTML+getState(t),setTimeout((()=>{effect(t,(r=>{setTimeout((()=>{"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.value=r),"SELECT"==e.tagName&&(e.value=r),"IMG"==e.tagName&&(e.src=r),"A"==e.tagName&&(e.href=r),"IFRAME"==e.tagName&&(e.src=r),"VIDEO"==e.tagName&&(e.src=r),"AUDIO"==e.tagName&&(e.src=r),"EMBED"==e.tagName&&(e.src=r),"OBJECT"==e.tagName&&(e.src=r),"SOURCE"==e.tagName&&(e.src=r),"TRACK"==e.tagName?e.src=r:e.innerHTML=r,document.querySelector(`#${t}`).innerHTML=r}),0)}))}),0)})),dhtml.querySelector("if")){let e=dhtml.querySelector("if"),t=e.getAttribute("prop")?e.getAttribute("prop"):null,r=e.getAttribute("is"),n=e.getAttribute("else"),o=e.parentNode,i=e.getAttribute("props")?e.getAttribute("props").split(","):null,l=html.querySelector(o.tagName);t&&i&&i.forEach((n=>{if(l.getAttribute(t)==r){let t=e.innerHTML;if(t.includes("{{")){let e=t.split("{{")[1].split("}}")[0];parsedjs(e,o)}}}))}dhtml.querySelectorAll("var").forEach((e=>{e.style.display="none";let t=e.getAttribute("name"),r=e.innerHTML;dhtml.querySelectorAll("*").forEach((e=>{let n=e.innerHTML.match(/{{(.*?)}}/g);if(n&&e.innerHTML.includes(`{{${t}}}`)){e.id=t;e.innerHTML;n.forEach((t=>{e.innerHTML=e.innerHTML.replace(t,r)}))}})),e.remove()})),dhtml.querySelectorAll("*").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.match(/{{(.*?)}}/g);if(t){let r=t[0].split("{{")[1].split("}}")[0];if(r.includes("json.map")){let t=r.split("json.map(")[1].split(")")[0];if(window[t]&&r.includes("return")){let n=r.split("return(")[1].split(")")[0].replace(/'/g,"");JSON.parse(window[t]).forEach((t=>{let r=document.createElement(n);r.innerHTML=r.innerHTML+t.name,e.innerHTML=r.outerHTML}))}}}}}));let proptemplates=[];dhtml.querySelectorAll("[props]").forEach((async e=>{let t=e.tagName;if(html.querySelector(t)){let r=e.getAttribute("props").split(":");r.forEach((async e=>{if(props[t]=r,sessionStorage.setItem("$dox-props",JSON.stringify(props)),"children"==e)html.querySelector(t).querySelector("slot")&&dhtml.querySelector(t).innerHTML.includes("{{children}}")&&(proptemplates.length>0&&proptemplates.forEach((e=>{e.parent==dhtml.querySelector(t).parentNode&&(dhtml.querySelector(t).innerHTML=e.template)})),proptemplates.push({element:dhtml.querySelector(t),template:dhtml.querySelector(t).innerHTML,parent:dhtml.querySelector(t).parentNode?dhtml.querySelector(t).parentNode:null}),dhtml.querySelector(t).innerHTML=dhtml.querySelector(t).innerHTML.replace("{{children}}",html.querySelector(t).querySelector("slot").innerHTML));else if(html.querySelector(t).getAttribute(e)&&(proptemplates.length>0&&proptemplates.forEach((r=>{dhtml.querySelector(t).innerHTML.includes(`{{${e}}}`)&&(dhtml.querySelector(t).innerHTML=dhtml.querySelector(t).innerHTML.replace(`{{${e}}}`,html.querySelector(t).getAttribute(e)))})),dhtml.querySelector(t).innerHTML.includes(`{{${e}}}`))){proptemplates.push({element:dhtml.querySelector(t),template:dhtml.querySelector(t).innerHTML,parent:dhtml.querySelector(t).parentNode?dhtml.querySelector(t).parentNode:null});let r=html.querySelector(t).getAttribute(e);dhtml.querySelector(t).innerHTML=dhtml.querySelector(t).innerHTML.replace(`{{${e}}}`,r)}}))}})),dhtml.querySelectorAll("*").forEach((e=>{Object.values(e.attributes).forEach((t=>{let r=t.value;if(r.includes("{{")){let n=r.match(/{{(.*?)}}/g);n&&(n.forEach((t=>{let n=t.replace("{{","").replace("}}",""),o=e.parentNode.getAttribute(n),i=document.querySelector(e.parentNode.tagName);i&&i.getAttribute(n)&&(o=i.getAttribute(n)),r=r.replace(new RegExp(`{{${n}}}`,"g"),o)})),e.setAttribute(t.name,r))}}));let t=e.innerHTML.match(/{{(.*?)}}/g);if(t&&t.forEach((t=>{let r=t.split("{{")[1].split("}}")[0],n=dhtml.querySelector(e.tagName).parentNode.tagName;html.querySelectorAll("*").forEach((t=>{if(t.tagName==n){let n=t.getAttribute(r);if(n){"true"==n.toString().toLowerCase()&&(n=n.toString().toLowerCase());let t=e.innerHTML.replace(new RegExp(`{{${r}}}`,"g"),n);e.innerHTML=t}}}))})),e.hasAttribute("state")){let t=e.getAttribute("state");e.innerHTML=e.innerHTML+getState(t),document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=e.innerHTML),effect(t,(t=>{document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=t)}))}})),exported.forEach((async e=>{let t=dhtml.querySelector(e)?dhtml.querySelector(e):html.querySelector(e);var r;(await(r=e,new Promise((e=>{if(document.querySelector(r))return e(document.querySelector(r));const t=new MutationObserver((n=>{document.querySelector(r)&&(e(document.querySelector(r)),t.disconnect())}));t.observe(document.body,{childList:!0,subtree:!0})})))).innerHTML=t.innerHTML}))}imports.map((async e=>{if(!(e.endsWith(".html")||e.endsWith(".css")||e.endsWith(".js")))throw new Error("Unsupported imported file type!");if(e.endsWith(".js")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/javascript",t.setAttribute("as","script"),document.querySelector("head").appendChild(t),cache[e]?cache[e]:await fetch(e).then((e=>e.text())).then((t=>{if(t.includes("document")&&!e.includes("tailwind.js"))throw new Error("Imported JS file cannot contain document. Use dox instead.");if((t.includes("innerHTML")||t.includes("innerText"))&&!e.endsWith("tailwind.js"))throw new Error("Use dox:text to return text and dox:$ to return HTML.");let r=document.createElement("script");r.id="dox-script",r.type="module",r.innerHTML=t,document.head.appendChild(r)}))}if(e.endsWith(".html")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/html",t.setAttribute("as","document"),document.querySelector("head").appendChild(t),cache[e]?parser(cache[e]):await fetch(e).then((e=>e.text())).then((async t=>{cache[e]=t,await parser(t)}))}})),window.Router=Router,window.dox=dox;const states={},setState=(e,t)=>{states[e]=t,window.postMessage({name:e,value:t},"*")},getState=e=>states[e];window.addEventListener("message",(e=>{if(e.origin!==window.location.origin)return;const{name:t,value:r}=e.data;states[t]=r}));const effect=(e,t=(()=>{}))=>{window.addEventListener("message",(r=>{if(r.origin!==window.location.origin)return;const{name:n,value:o}=r.data;n===e&&t(o)}))};window.effect=effect,window.getState=getState,window.setState=setState,window.dox=dox;