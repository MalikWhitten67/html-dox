let e=[],t=document.querySelector("imports");t.style.display="none";let r=[],n=t.innerHTML.replace(/\s/g,"");n=n.split(","),n=n.filter(Boolean);let o={};if(document.querySelector("script")&&!document.querySelector("script").getAttribute("src").includes("html-dox.js"))throw new Error("html-dox.js must be the last script tag in the body");if(document.querySelector("style"))throw new Error("Style tags are not supported in dox!");if(document.querySelector("link"))throw new Error("Link tags are not supported in dox!");document.body.style.display="none";let i=[],l={"dox:string":String,"dox:number":Number,"dox:boolean":Boolean,"dox:array":Array,"dox:object":Object,"dox:undefined":void 0,"dox:null":null,"dox:function":Function,"dox:regexp":RegExp,"dox:date":Date},a=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):{};function s(e,t,n,o){let i=o.getAttribute("exports").split(","),l=(new DOMParser).parseFromString(e,"text/html"),a={};l.querySelectorAll("var").forEach((e=>{e.style.display="none";let t=e.getAttribute("name"),n=e.innerHTML;l.querySelectorAll("*").forEach((e=>{e.innerHTML.includes(`{{${t}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t}}}`,n)),r.forEach((t=>{e.innerHTML.includes(`{{${t.name}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t.name}}}`,t.value))}))})),e.remove()})),l.querySelectorAll("[props]").forEach((e=>{let r=e.tagName;if(t.querySelector(r)){let n=e.getAttribute("props").split(":");n.forEach((e=>{a[r]=n,sessionStorage.setItem("$dox-props",JSON.stringify(a)),"children"==e&&t.querySelector(r).querySelector("slot")&&l.querySelector(r).innerHTML.includes("{{children}}")&&(l.querySelector(r).innerHTML=l.querySelector(r).innerHTML.replace("{{children}}",t.querySelector(r).querySelector("slot").innerHTML))}))}})),l.querySelectorAll("*").forEach((e=>{Object.values(e.attributes).forEach((t=>{let r=t.value;if(r.includes("{{")){let n=r.match(/{{(.*?)}}/g);n&&(n.forEach((t=>{let n=t.replace("{{","").replace("}}",""),o=e.parentNode.getAttribute(n),i=document.querySelector(e.parentNode.tagName);i&&i.getAttribute(n)&&(o=i.getAttribute(n)),r=r.replace(new RegExp(`{{${n}}}`,"g"),o)})),e.setAttribute(t.name,r))}}));let r=e.innerHTML.match(/{{(.*?)}}/g);if(r&&r.forEach((r=>{let n=r.split("{{")[1].split("}}")[0],o=l.querySelector(e.tagName).parentNode.tagName;t.querySelectorAll("*").forEach((t=>{if(t.tagName==o){let r=t.getAttribute(n);if(r){"true"==r.toString().toLowerCase()&&(r=r.toString().toLowerCase());let t=e.innerHTML.replace(new RegExp(`{{${n}}}`,"g"),r);e.innerHTML=t}}}))})),e.hasAttribute("state")){let t=e.getAttribute("state");console.log(e.getAttribute("state")),e.innerHTML=e.innerHTML+d(t),document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=e.innerHTML),h(t,(t=>{document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=t)}))}o.getAttribute("exports").split(",").forEach((e=>{let r=e.replace(/\s/g,"");i.forEach((e=>{e==r&&t.querySelector(r)&&(t.querySelector(r).innerHTML=l.querySelector(r).innerHTML,n.querySelector(r)&&l.querySelector(r)&&(n.querySelector(r).innerHTML=l.querySelector(r).innerHTML))}))}))}))}n.map((e=>{if(!e.endsWith(".html")&&!e.endsWith(".css")&&!e.endsWith(".js"))throw new Error("Unsupported imported file type!");if(e.endsWith(".html")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/html",t.setAttribute("as","document"),document.querySelector("head").appendChild(t),o[e]?c(o[e]):fetch(e).then((e=>e.text())).then((t=>{o[e]=t,c(t)}))}else if(e.endsWith(".css")){let t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/css",t.setAttribute("as","style"),document.querySelector("head").appendChild(t);let r=document.createElement("style");if(o[e]){let t=document.createElement("style");t.innerHTML=o[e],document.querySelector("head").appendChild(t)}else fetch(e).then((e=>e.text())).then((t=>{o[e]=t,r.innerHTML=t,document.querySelector("head").appendChild(r)}))}else if(e.endsWith(".js")){let t=document.createElement("link");if(t.setAttribute("rel","preload"),t.setAttribute("href",e),t.type="text/javascript",t.setAttribute("as","script"),document.querySelector("head").appendChild(t),o[e]){new Function(o[e])()}else fetch(e).then((e=>e.text())).then((t=>{if(t.includes("document")&&!e.includes("tailwind.js"))throw new Error("Imported JS file cannot contain document. Use dox instead.");if((t.includes("innerHTML")||t.includes("innerText"))&&!e.endsWith("tailwind.js"))throw new Error("Use dox:text to return text and dox:$ to return HTML.");let r=document.createElement("script");r.innerHTML=t,r.type="module",document.querySelector("head").appendChild(r)}))}}));const c=t=>{let n=(new DOMParser).parseFromString(t,"text/html");n=n.querySelector("html");let o,c=document.querySelector("body"),u=performance.now(),p=n.querySelector("export");if(n.querySelectorAll("var").forEach((e=>{e.style.display="none";let t=e.getAttribute("name"),o=e.innerHTML;n.querySelectorAll("*").forEach((e=>{e.innerHTML.includes(`{{${t}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t}}}`,o)),r.forEach((t=>{e.innerHTML.includes(`{{${t.name}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${t.name}}}`,t.value))}))})),e.remove()})),p){function f(e){e.inject=t=>{console.log(e),e.innerHTML=t};let t=sessionStorage.getItem("$dox-props")?JSON.parse(sessionStorage.getItem("$dox-props")):[];return t=t[e.tagName],t&&(e.props=t),e.class=t=>{e.className=t},e.parent=()=>e.parentNode,e.classes=e.classList,e.html=()=>e.innerHTML,e.text=e.innerText,e.prepend=t=>{e.innerHTML=t+e.innerHTML},e.append=t=>{console.log(e,t),e.innerHTML+=t},e.blur=()=>{e.blur()},e.fade=t=>{e.style.transition=`opacity ${t}s`,e.style.opacity=0},e.focus=e.focus,e.queryAll=t=>{let r=e.querySelectorAll(t);return e.forEach=e=>{r.forEach((t=>{e(t)}))},r.forEach((e=>{e=f(e)})),r},e.after=t=>{e.insertAdjacentHTML("afterend",t)},e.before=t=>{e.insertAdjacentHTML("beforebegin",t)},e.attr=(t,r)=>{if(!r)return e.getAttribute(t);e.setAttribute(t,r)},e.replace=(t,r)=>{let n=document.createElement(t);n.innerHTML=r,e.parentNode.replaceChild(n,e)},e.on=(t,r)=>{e.addEventListener(t,r)},e.getChildren=()=>{let t=[],r=e=>{let n=e.children;for(let o=0;o<n.length;o++)n[o]=f(n[o]),n[o].parent=e,n[o].index=o,t.push(n[o]),r(n[o])};return e.forEach=e=>{t.forEach((t=>{e(t)}))},e.map=(e,r)=>{r?t.forEach((t=>{e(t,r)})):t.forEach((t=>{e(t)}))},r(e),t},e}p=p.innerHTML.replace(/\s/g,""),p=p.split(","),p=p.filter(Boolean);let m={currentRoute:()=>window.location.hash.split("#")[1],addEl:e=>f(document.createElement(e)),querySelector:e=>{let t=document.querySelector(e)||n.querySelector(e);if(t)return f(t)},querySelectorAll:e=>{let t=document.querySelectorAll(e)||n.querySelectorAll(e);return t.forEach((e=>{e=f(e)})),t},html:document.querySelector("html").innerHTML,text:document.querySelector("html").innerText,on:(e,t)=>{window.addEventListener(e,t)},post:(e,t,r,n)=>{"object"==typeof t?(t=JSON.stringify(t),fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text()))):"string"==typeof t?fetch(e,{method:"POST",headers:{"Content-Type":"text/plain",headers:n},body:t}).then((e=>"json"==n.responseType?e.json():e.text())).then((e=>{r(e)})):JSON.parse(t)&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},get:(e,t,r)=>{fetch(e,{method:"GET",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))},put:(e,t,r,n)=>{fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",headers:n},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{r(e)}))},delete:(e,t,r)=>{fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json",headers:r}}).then((e=>e.json())).then((e=>{t(e)}))}};window.dox=m,p.forEach((t=>{let r=n.querySelector(t);[].forEach((e=>{if(r.hasAttribute(e)&&"typeof"===e){let n=i.find((t=>t.name===r.getAttribute(e)));if(!n)throw new Error(`Type "${r.getAttribute(e)}" does not exist`);{let e,r=l[n.constraint],o=c.querySelector(t).innerHTML;if("false"===n.isStrict)return;if(r===Number){if(e=Number(o),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid value for type "${n.name}": ${o} (expected number)`)}else if(r===Boolean)if("true"===o.toLowerCase())e=!0;else{if("false"!==o.toLowerCase())throw new Error(`Invalid value for type "${n.name}": ${o} (expected boolean)`);e=!1}else{if(r!==String)throw new Error(`Invalid constraint type for type "${n.name}": ${n.constraint}`);e=o}}}}));if(n.querySelectorAll("*").forEach((e=>{if(e.hasAttribute("state")){let t=e.getAttribute("state");console.log(e.getAttribute("state")),e.innerHTML=e.innerHTML+d(t),document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=e.innerHTML),h(t,(t=>{document.querySelector(e.tagName)&&(document.querySelector(e.tagName).innerHTML=t)}))}})),n.querySelector(t).hasAttribute("props")){let e=n.querySelector(t).getAttribute("props").split(":");e.forEach((n=>{a[t]=e,sessionStorage.setItem("$dox-props",JSON.stringify(a)),r.querySelectorAll("[derive]").forEach((e=>{let r=e.getAttribute("derive"),n=c.querySelector(t).getAttribute(r);e.innerHTML.includes(`{{${r}}}`)&&(e.innerHTML=e.innerHTML.replace(`{{${r}}}`,n))})),r.innerHTML.split("{{").forEach((e=>{let n=e.split("}}")[0];r.innerHTML.includes(`{{${n}}}`)&&(r.innerHTML=r.innerHTML.replace(`{{${n}}}`,c.querySelector(t).getAttribute(n)))})),r.innerHTML.includes(`{{${n}}}`)&&(r.innerHTML=r.innerHTML.replace(`{{${n}}}`,c.querySelector(t).getAttribute(n)))}))}e.push({name:r.tagName,template:r.innerHTML});let p=c.querySelector(t);function f(e){if(p){document.querySelector(p.tagName).innerHTML=p.innerHTML,n.querySelectorAll("import").forEach((e=>{let t=e.getAttribute("src");if(!t.endsWith(".html"))throw new Error("Unsupported imported file type!");window[t]?s(window[t],n,c,e):fetch(t).then((e=>e.text())).then((r=>{window[t]=r,s(r,n,c,e)}))}))}}p.innerHTML=r.innerHTML;let m=document.querySelector("meta[config]"),y=m.getAttribute("fallback"),g={};function b(e){if(o=performance.now()-u,g[window.location.hash]||(window.location.hash=y),p&&!e){f();let e=p?p.parentNode:null,o=n.querySelector(t);if(g[window.location.hash]=o.innerHTML,e&&e.hasAttribute("route")||e.hasAttribute("overide")){let t=e.getAttribute("route"),n=e.getAttribute("position");t&&"first"===n?r(p,o,"first",e.getAttribute("route"),e.getAttribute("title")):t&&"last"===n&&r(p,o,"last",e.getAttribute("route"),e.getAttribute("title"))}else{let e=document.createElement("div");e.style="position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:9999; font-family: sans-serif; font-size: 30px;",e.innerHTML='<h1 style="text-align:center;margin-top:50vh">Route is blocked!</h1>',p.innerHTML=e.outerHTML}}else{let o=document.querySelector(e),i=o?o.parentNode:null,l=n.querySelector(t);if(g[window.location.hash]=l.innerHTML,i&&i.hasAttribute("route")||i.hasAttribute("overide")){let e=i.getAttribute("route"),t=i.getAttribute("position");o.innerHTML="",e&&"first"===t?r(o,l,"first",i.getAttribute("route"),i.getAttribute("title")):e&&"last"===t&&r(o,l,"last",i.getAttribute("route"),i.getAttribute("title"))}else{let e=document.createElement("div");e.style="position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:9999; font-family: sans-serif; font-size: 30px;",e.innerHTML='<h1 style="text-align:center;margin-top:50vh">Route is blocked!</h1>',p.innerHTML=e.outerHTML}}function r(e,t,r,n,o){let i;if(g[n]=t.innerHTML,i=!(n="#"+n),e.querySelectorAll("*").forEach((e=>{e.hasAttribute("route")&&(e.innerHTML="")})),n===window.location.hash&&!i)return document.title=o||"html-dox",void(p.innerHTML=t.innerHTML);p.innerHTML=""}}m&&(m=m.getAttribute("routes"),m=m.split(","),m.forEach((e=>{g[`#${e}`]=`#${e}`}))),y="#"+y,g[window.location.hash]||(window.location.hash=y),b(),window.addEventListener("hashchange",(()=>{document.querySelector("html").setAttribute("root",window.location.hash.split("#")[1]),b(),f()}))}))}window.$import=e=>{if(!e.endsWith(".js"))return window[e];fetch(e).then((e=>e.text())).then((e=>{if(e.includes("document")&&!item.includes("tailwind.js"))throw new Error("Imported js file cannot contain document use dox instead");if(e.includes("innerHTML")||e.includes("innerText")&&!item.endsWith("tailwind.js"))throw new Error("use dox:text  to return text and dox:$ to return html");let t=document.createElement("script");t.innerHTML=e,t.type="module",document.querySelector("head").appendChild(t),console.log(e)}))},window.$export=(e,t)=>{window[e]=t},c.querySelectorAll("type").forEach((e=>{let t=e.querySelectorAll("subtype");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!l[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),t.forEach((e=>{if(!l[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint")})})),n.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];c.querySelectorAll(`[${t}]`).forEach((r=>{let n=r.getAttribute(t),o=e.getAttribute("subtype"),a=i.find((e=>e.name===o)),s=a.isStrict;if(a&&s){let e,t=l[a.constraint];if(t===Number){if(e=Number(n),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${o}": ${n} (expected number)`)}else if(t===Boolean)if("true"===n.toLowerCase())e=!0;else{if("false"!==n.toLowerCase())throw new Error(`Invalid attribute value for subtype "${o}": ${n} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${o}": ${a.constraint}`);e=n}}}))}}))})),n.querySelectorAll("type").forEach((e=>{let t=e.querySelectorAll("subtype"),r=[];t.forEach((t=>{if(r.push(t.getAttribute("name")),r.filter(((e,t)=>r.indexOf(e)!==t)).length>0)throw new Error("Two subtypes cannot have the same name");if(t.getAttribute("name")===e.getAttribute("name"))throw new Error("Types and subtypes cannot have the same name")})),i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")}),e.querySelectorAll("subtype").forEach((e=>{if(!l[e.getAttribute("constraint")])throw new Error("The constraint type does not exist");i.push({name:e.getAttribute("name"),constraint:e.getAttribute("constraint"),isStrict:e.getAttribute("isStrict")})})),n.querySelectorAll("[subtype]").forEach((e=>{if(e.innerHTML.includes("{{")){let t=e.innerHTML.split("{{")[1].split("}}")[0];c.querySelectorAll(`[${t}]`).forEach((r=>{let n=r.getAttribute(t),o=e.getAttribute("subtype"),a=i.find((e=>e.name===o)),s=a.isStrict;if(a&&s){let e,t=l[a.constraint];if(t===Number){if(e=Number(n),e=isNaN(e)?0:e,0===e)throw new Error(`Invalid  value for subtype "${o}": ${n} (expected number)`)}else if(t===Boolean)if("true"===n.toLowerCase())e=!0;else{if("false"!==n.toLowerCase())throw new Error(`Invalid attribute value for subtype "${o}": ${n} (expected boolean)`);e=!1}else{if(t!==String)throw new Error(`Invalid constraint type for subtype "${o}": ${a.constraint}`);e=n}}}))}}))}))};document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{document.body.style.display="block"}),250)}));const u={},d=e=>u[e];window.addEventListener("message",(e=>{if(e.origin!==window.location.origin)return;const{name:t,value:r}=e.data;u[t]=r}));const h=(e,t=(()=>{}))=>{window.addEventListener("message",(r=>{if(r.origin!==window.location.origin)return;const{name:n,value:o}=r.data;n===e&&t(o)}))};window.effect=h,window.getState=d,window.setState=(e,t)=>{u[e]=t,window.postMessage({name:e,value:t},"*")};